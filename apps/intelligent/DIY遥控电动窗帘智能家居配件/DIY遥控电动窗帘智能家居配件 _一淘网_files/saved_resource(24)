KISSY.add("header/_6",function(e,t,a,o,n,r,s,i,h,c,u,d,m,l,p,w){function g(){g.superclass.constructor.apply(this,arguments),this.init()}var f=t.all;return e.extend(g,a,{init:function(){var t=["history","list","wanke","cloud","hot-search","hot-search-brand"],a=[new i,new h({activeCls:"selected",node:".s-menu-list li"}),new c,new u,new d,new m,new l],o="http://suggest-pre.etao.com/sug?area=etao&k=1";f(".searchHot").insertAfter(".s-ipt-container").removeClass("searchshow").css("display",""),r.ie<9&&e.use("ecc/placeholder/1.0.1/index",function(e,t){new t});new s({plugins:a,sugConfig:{sourceUrl:o,node:"#J_searchIpt",focused:!1,resultFormat:""},mods:{sort:t}});new w,this._initSearchVal(),this._getSpm()},_initSearchVal:function(){var t=new n(location.href).getQuery(),a=t.get("eq");(""===a||void 0===a)&&(a=t.get("q"));try{a&&(a=decodeURI(a),e.one("#J_searchIpt").val(a))}catch(o){}},_getSpm:function(){function t(){var e="";switch(r){case"temai.etao.com":e="http://temai.etao.com";break;case"wanke.etao.com":e="http://wanke.etao.com";break;case"jf.etao.com":e="http://jf.etao.com";break;case"haiwai.etao.com":e="http://haiwai.etao.com";break;case"haohuo.etao.com":e="http://haohuo.etao.com"}return e}function a(){return"haohuo"===location.pathname.substring(1,7)?!0:!1}function o(){var e=!1,t=location.pathname;return"haitao"===t.substring(1,7)?e=!0:"buy"===location.pathname.substring(1,4)?e=!0:"jingxuan"===location.pathname.substring(1,9)?e=!0:"tuan"===location.pathname.substring(1,5)&&(e=!0),e}var r=location.hostname,s="";if(s=t(),""===s&&(a()?s="http://www.etao.com/haohuo/index.html":o()&&(s="http://www.etao.com/haitao/index.html")),""!==s){var i,h=e.one("#J_etaoLogoIndex"),c=h.attr("href");i=new n(c).getQuery().get("spm"),s+="?spm="+i,h.attr("href",s)}}}),g},{requires:["node","base","overlay","uri","ua","header/_5","header/_2","header/_d","header/_1","header/_4","header/_e","header/_3","header/_a","json","header/_0","header/p/header/index.css"]});KISSY.add("header/_5",function(e,t,r,a,n,o){var i=t.all,u=r.extend([],{initializer:function(){var e=this;e._initCombo()},_setComboCache:function(e){var t=this,r=t.get("tab");t.configArr=t.configArr||[],t.configArr[r]={data:e}},_checkHasTab:function(){var e=this,t=e.getPlugin("tab");t||(e.tabNode=e.comboBox.get("input").parent("form"))},_initComboEvent:function(){var t=this,r=t.comboBox,a=r.get("input");a.on("click",function(){if(t.fire("beforeFocus")!==!1){var n=e.trim(a.val()),o=t.get("sugConfig"),i=o.prefixCls,u=r.get("el").hasClass(i+"combobox-focused");u&&(o.autoCollapsed||""===n)&&r.sendRequest(n)}}),a.on("blur",function(){t.fire("beforeBlur")}),r.on("click",t.comboClick,t),r.on("afterCollapsedChange",t._addExtraEvent,t),r.on("afterCollapsedChange",function(e){t.fire("afterCollapsedChange",e)}),t._formSubmitEvent(),t.query=a.val(),t.on("afterTabChange",function(){var e=this,t=e.comboBox,r=t.get("input"),a=r.parent("form");a.fire("submit")}),t.on("beforeParse",function(e){if(""!==e.query){var t=e.results;if(!t.result.length)return;t.activity=e.query}})},send:function(e,t){var r,a;t?(r="/tongji",a="H51884970"):(r="/search",a="H51884969"),(window.goldlog_queue||(window.goldlog_queue=[])).push({action:"goldlog.record",arguments:[r,"",e,a]})},_formSubmitEvent:function(){var t,r,a,n,o=this,i=o.comboBox,u=i.get("input"),s=u.parent("form"),l="",c=i.get("input");s.on("submit",function(i){if(o.fire("beforeSubmit",{el:s,isInitSearch:!0})!==!1){if(t=s.attr("action"),r=t.split("?")[1],""===e.trim(c.val())&&!o._emptyJump(s))return void i.preventDefault();var u=e.one("#J_eq"),f=e.one("#J_searchIpt").val();if(u.val(encodeURI(f)),r){a=r.split("&");for(var g in a)n=a[g].split("="),l+='<input type="hidden" name="'+n[0]+'" value="'+n[1]+'"/>';s.append(l)}}else i.halt()})},_defaultPageJump:function(t){var r,a=this,n=a.tabNode;return n?(r=t.attr("data-defaultpage")||n.attr("data-defaultpage"),r?e.startsWith(r,"http")?(a.redirect(r,"_blank"),!1):!1:void 0):!1},_emptyJump:function(e){{var t,r=this,a=e.one("label"),n=r.get("sugConfig");n.tab}return a?(t=a.one("span"),t&&""!==t.text()?(a.hide(),void r._holderJump(e,t.text())):r._defaultPageJump(e)):r._defaultPageJump(e)},_holderJump:function(e,t){var r=e[0].q;r&&(r.value=t),e.append('<input type="hidden" name="style" value="grid" />')},comboClick:function(r){var n=this,o=r.target.get?r.target.get("el"):t.one(r.currentTarget),u=n.comboBox;n.fire("beforeSubmit",{el:o,isInitSearch:!1});var s=n.query,l=n.query,c=a.children(o),f=a.attr(c,"data-key")||"q="+s,g=a.parent(u.get("el"),"form"),d=a.attr(g,"action"),p=a.attr(c,"data-action")||n.get("action")||d,m=a.attr(g,"target"),h=a.attr(c,"data-target"),v="&wq="+l+"&suggest_query="+s+"&source=suggest",_=n._getInputsVal(g),b=e.all(c).hasClass("J_HotFocus");b&&(v+="&suggest_type=4");var C=i(".search-menu-extras-history").length;i(".search-menuitem").length==C&&C>0&&5>C&&(!i(".J_CHotSearch").length||"none"===i(".J_CHotSearch").css("display"))&&(v+="&suggest_type=6"),a.attr(c,"data-epid")?(v+="&suggest_prd=1",v+="&suggest_type=1"):v+="&suggest_auc=1",p+=p.indexOf("?")>-1?"&":"?",n.redirect(p+f+v+_,h||m)},redirect:function(e,t){var r=document.createElement("a"),t=t||"_self";r.setAttribute("href",e),r.setAttribute("target",t),r.style.display="none",document.body.appendChild(r),r.click()},_initativeSearchStat:function(e){var t,r=this,a=window.location.host,n=a.substring(0,a.indexOf(".")),o=new Date,i=o.getMonth()+1,u=o.getDate();i=10>i?"0"+i.toString():i.toString(),u=10>u?"0"+u.toString():u.toString(),t=o.getFullYear().toString()+i+u;var s=n+"etao_"+t;r._writeHiddenInput(e,"initiative_id",s),"www"===n&&r._writeHiddenInput(e,"spm","1002.1.8.1")},_writeHiddenInput:function(t,r,a){var n=t[r];return n?n.value=a:(n=e.DOM.create('<input type="hidden" name="'+r+'" value="'+a+'" />'),t.appendChild(n)),n},_getInputsVal:function(t){var r,n,o=this,i=o.get("sugConfig"),u=i.excludeParam,s=[];inputs=a.query("input",t);for(var l=inputs.length-1;l>=0;l--)r=inputs[l],n=r.name,n&&!e.inArray(n,u)&&s.push(n+"="+encodeURIComponent(r.value));return s.length<1?"":"&"+s.join("&")},_getDefComboCfg:function(){return{focused:!1,hasTrigger:!1,matchElWidth:!0,srcNode:".allWidth",highlightMatchItem:!1,menu:{align:{overflow:{adjustY:0}}},cache:!0}},_prepareHtml:function(e,r){var n=this,o='<div class="{cls}combobox"><div class="{cls}combobox-input-wrap"></div></div>',i=o.replace(/{cls}/g,r),u=a.create(i),s=(this.getPlugin("history"),{"aria-haspopup":"true","aria-combobox":"list",role:"combobox",autocomplete:"off","class":r+"combobox-input","x-webkit-grammar":"builtin:translate"});return a.attr(e,"aria-label")||(s.title=s["aria-label"]=n._isOpen("history")?"\u8bf7\u8f93\u5165\u641c\u7d22\u6587\u5b57\u6216\u4ece\u641c\u7d22\u5386\u53f2\u4e2d\u9009\u62e9":"\u8bf7\u8f93\u5165\u641c\u7d22\u6587\u5b57"),a.attr(e,s),a.wrap(e,u),this.get("sugConfig").focused&&a.get(e).focus(),t.one("."+r+"combobox")},_isOpen:function(t){var r=this,a=r.get("mods"),n=a.sort;return e.inArray(t,n)},_getRenderMods:function(){var t=this,r=e.merge(o,t.get("mods"));t.set("mods",r)},_getDataSourceCfg:function(){var t=this,r=(t.get("sugConfig"),t.get("dataSourceCfg"));return r.xhrCfg.url="http://suggest.taobao.com/sug?area=etao_new&k=1",r.parse=e.bind(t.parse,t),r},_getComboCfg:function(t){var r=this,a=r.get("sugConfig"),n=r._getDefComboCfg();return n.srcNode=r._prepareHtml(a.node,a.prefixCls),n.dataSource=t,n.format=e.bind(r.format,r),n.prefixCls=a.prefixCls,n},_initCombo:function(){var e,t,r=this,a=r._getDataSourceCfg();r._getRenderMods(),e=new n.RemoteDataSource(a),r._setComboCache(e),t=r._getComboCfg(e);var o=new n(t);o.render(),r.comboBox=o,r._checkHasTab(),r._initComboEvent(),r._initativeSearchStat(r.get("form")[0]),r._autofocus()},_autofocus:function(){var e=this,t=e.comboBox,r=t.get("input"),a=r.attr("data-autofocus"),n=location.hash;!n&&a&&"autofocus"==a&&r.getDOMNode().focus()},update:function(t){for(var r=this,a=r.get("plugins"),n=0,o=a.length-1;o>=n;n++){var i=a[n];i&&e.isFunction(i.update)&&i.update.call(i,t)}},parse:function(e,t){var r=this,a=r.fire("beforeParse",{results:t,query:e});if(a===!1)return[[""]];if(a&&(t=a),!t.result)return[[""]];var r=this,n=t.result;delete t.result;var o=r.comboBox.get("dataSource");if((o.extraData||(o.extraData=[]))[e]=t,0===n.length)return[[""]];for(var i in n)n[i]||n.splice(i,1);return n},format:function(e,t){var r=this;return r.resultArr=[],r.render(e,t),r.resultArr},render:function(e,t){var r,a,n,o,i,u,s=this,l=s.get("mods"),c=l.sort,f=s._adjustExtra(e,l.showExtra);s.query=e;for(var g=0,d=c.length-1;d>=g;g++)if(u=c[g])if("list"!==u){if(i=s.getPlugin(u),i&&i.renderPlugin)i.renderPlugin({query:e,results:t});else if(a=l[u],a&&f&&(!(o=a.pos)||n!==o)){if(r=a.tmpl,!r)continue;var p=s.resultArr.length,m=s.diffLen||0;n=s.defaultRender({tmpl:r,name:u,pos:o,always:a.always&&t.length>0,callback:a.callback,index:p-m})}}else a=l[u],r=a.tmpl,s._list(e,t,r);s.fire("afterQueryChange",{query:e})},defaultRender:function(t){var r,a=this,n=t.tmpl,o=t.name,i=a.comboBox.get("dataSource"),u=a.query,s=a.get("sugConfig").prefixCls,l=i.extraData,c=t.pos,f=t.index;if(l&&l[u]||t.always){var g=a._getDate(),d={$query:u,$date:g,prefixCls:s};if(!t.always){var p=l[u][o],m=!0;if(!p)return;if(e.isArray(p)){p.length>2&&(p.length=2);for(var h=0,v=p.length-1;v>=h;h++){var _=p[h];if(e.isArray(_)){m=!1;for(var b=0,C=_.length-1;C>=b;b++)d["$"+b]=_[b]||"";d.$index=f+1+h,r=e.substitute(n,d),a.addContent({html:r,query:u,position:c,callback:t.callback})}else d["$"+h]=_,d.$index=f+1+h}return m&&(r=e.substitute(n,d),a.addContent({html:r,query:u,position:c,callback:t.callback})),c}d[o]=p}return d.$index=f+1,r=e.substitute(n,d),a.addContent({html:r,query:u,position:c,callback:t.callback}),c}},_adjustExtra:function(e){return""!==e?!0:!1},getNick:function(){var e=this;return e._getCookie("_nk_")||e._getCookie("tracknick")},_getCookie:function(t){var r=window;if(r.userCookie&&!e.isUndefined(r.userCookie[t]))return r.userCookie[t];if(r.SRP_COOKIES||(r.SRP_COOKIES={})&&e.isUndefined(SRP_COOKIES[t])){var a=document.cookie.match("(?:^|;)\\s*"+t+"=([^;]*)");SRP_COOKIES[t]=a&&a[1]?decodeURIComponent(a[1]):""}return SRP_COOKIES[t]},_getDate:function(){var e=new Date;return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+(e.getDate()+1)},_list:function(t,r,a){var n,o=this,i=o.get("sugConfig").resultFormat,u=o.resultArr||(o.resultArr=[]),s=o.comboBox;e.each(r,function(o,s){if(!o||!o[0])return void r.splice(s,1);var l,c=o[0],f="",g=t;if(c.match(/<b>/))n=c.replace(/<b>(\S+?)<\/b>/g,function(e,t){return t}),f=c,c="";else{for(;c.indexOf(g)<0;)g=g.substr(0,g.length-1);""===g?(f="",c=c):0===c.indexOf(g)&&(f=g,c=c.replace(g,"")),n=o[0]}for(var d in u)if(l=u[d],l.textContent===o[0]&&l.unique)return;a=a.replace("{format}",i),u.push({textContent:n,content:e.substitute(a,{query:f,encodeText:encodeURI(c),text:c,index:s+1,count:o[1],textContent:n}),list:!0})}),o.resultArr=u;var l=s.get("menu");if(l.get){var c=l.get("el");r.length?c&&c.removeClass("empty-suggest"):c&&c.addClass("empty-suggest")}},addContent:function(e){var t=this,r=e.html,a=e.position,n=e.query;if(!a){var o=t.resultArr||[];return void o.push({content:r,textContent:n})}t["__"+a]={tmpl:r},t._addExtraEvent()},_renderHeader:function(e,r,a){var n="";if(r){var o=this.get("sugConfig").prefixCls;e||(e=new t("<div class='"+o+"combobox-menu-header "+n+"'></div>").prependTo(a)),e.empty().append(r.tmpl)}else e&&e.remove()},_renderFooter:function(e,r,a){var n=this,o=n.get("sugConfig").prefixCls,i=r&&r.type+"-footer"||"";if(r){e||(e=new t("<div class='"+o+"combobox-menu-footer "+i+"'></div>").appendTo(a)),r.css&&e.css(r.css),e.empty().append(r.tmpl);var u=e.one("."+o+"menu-history-clean");u&&u.on("click",function(e){e.halt();var t=n.getPlugin("history");t._cleanHistory()})}else e&&e.remove()},_addExtraEvent:function(e){var t=this,r=t.comboBox||t,a=t.__header,n=t.__footer,o=t.__lastHeader,i=t.__lastFooter,u=t.get("sugConfig").prefixCls;if(!e||e&&!e.newVal){var s=r.get("menu");if(!s.get)return;var l=s.get("el");if(!l||l.all("."+u+"menuitem").length<1)return;var c=l.one("."+u+"combobox-menu-header"),f=l.one("."+u+"combobox-menu-footer");o!==a&&(t.__lastHeader=a,t._renderHeader(c,a,l)),i!==n&&(t.__lastFooter=n,t._renderFooter(f,n,l))}else t.__header=null,t.__footer=null}},{ATTRS:{f_stats_show:{value:"f_stats_show=suggest_fc_show:1"},sugConfig:{value:{extraPassParams:"",extraPostParams:"",sourceUrl:"",tab:"item",autoCollapsed:!0,focused:!1,prefixCls:"search-",excludeParam:["q"],resultFormat:"\u7ea6{count}\u4e2a\u5b9d\u8d1d"},setter:function(t){var r=this.get("sugConfig");return e.mix(r,t,void 0,void 0,!0)}},mods:{value:{},setter:function(e){return e}},input:{getter:function(){return this.comboBox.get("input")}},form:{getter:function(){return this.get("input").parent("form")}},menu:{getter:function(){return this.comboBox.get("menu")}},dataSourceCfg:{value:{xhrCfg:{url:"",dataType:"jsonp",scriptCharset:"utf-8",data:{code:"utf-8"}},allowEmpty:!0,paramName:"q",cache:!0}}}});return u},{requires:["node","rich-base","dom","header/_c","header/_9"]});KISSY.add("header/_c",function(e,t){function r(e){r.superclass.constructor.call(this,e||{})}return r=t.extend({initializer:function(){var e=this;e.on("afterRenderData",function(){e.fire("beforeShow")})},sendRequest:function(e){var t=this,r=t.constructor.superclass.sendRequest;t.fire("beforeQueryChange",{query:e})!==!1&&r.apply(this,arguments)},handleKeyDownInternal:function(e){var t=this,r=t.constructor.superclass.handleKeyDownInternal;t.fire("beforeKeyDown",{event:e})!==!1&&r.apply(this,arguments)},handleKeyEventInternal:function(e){var t=this,r=t.constructor.superclass.handleKeyEventInternal;t.fire("beforeKeyDown",{event:e})!==!1&&r.apply(this,arguments)},setValueInternal:function(e){var t=this,r=t.constructor.superclass.setValueInternal;t.fire("beforeSetInputValue",{event:e})!==!1&&r.apply(this,arguments)},renderItems:function(t,r,n){var a,s,u=this,o=u.get("sugConfig").resultFormat,i=u.resultArr||(u.resultArr=[]),c="",l=t;e.each(r,function(t,u){if(!t||!t[0])return void r.splice(u,1);for(a=t[0];a.indexOf(l)<0;)l=l.substr(0,l.length-1);""===l?(c=a,a=""):0===a.indexOf(l)&&(c=l,a=a.replace(l,""));for(var f in i)if(s=i[f],s.textContent===t[0]&&s.unique)return;n=n.replace("{format}",o),i.push({textContent:t[0],content:e.substitute(n,{query:c,text:a,index:u+1,count:t[1]}),list:!0})}),u.resultArr=i},alignInternal:function(e){var t=this,r=t.constructor.superclass.alignInternal;t.fire("beforeShow",{event:e})!==!1&&r.apply(this,arguments)}},{ATTRS:{dataSourceCfg:{value:{xhrCfg:{url:"",dataType:"jsonp",scriptCharset:"utf-8",data:{code:"utf-8"}},allowEmpty:!0,paramName:"q",cache:!0}},mods:{value:{},setter:function(e){return e}}}}),r.RemoteDataSource=t.RemoteDataSource,r},{requires:["combobox"]});KISSY.add("header/_9",function(){return{list:{tmpl:'<div data-index="{index}" class="item-wrapper" data-text="{query}{text}" data-key="q={query}{text}&suggest=0_{index}{extra}"><span class="item-text"><b>{query}</b>{text}</span></div>'},hotSearchList:{tmpl:'<div data-index="{index}" class="item-wrapper J_HotFocus" data-text="{text}" data-key="q={text}&suggest=0_{index}"><span class="item-text">{index}.{text}</span></div>'},showExtra:!1}});KISSY.add("header/_2",function(e,t,r,a,s,i){function n(t){n.superclass.constructor.call(this,t||{}),e.sug=e.bind(this._retSug,this)}var o=r.all;return e.extend(n,t,{pluginInitializer:function(t){var r=this,a=t.get("sugConfig"),s=a.tab||"";t.set("extend",{history:!0}),r.set("caller",t),r.historyLocalQuery=new i({name:"history",tab:s,user:t.getNick()}),r.hitedHistoryListMap={};var n=t.comboBox;n.on("afterClickCloud",function(e){r._saveSpu(e)}),n.on("afterCollapsedChange",function(e){e.newVal||(n.detach("afterCollapsedChange",arguments.callee),n.get("menu").get("el").delegate("mousedown",".J_HistoryClear",r._cleanHistory,r),n.on("click",r.saveItemVal,r))}),t.on("beforeSubmit",function(){var t,a=n.get("input").val();""===e.trim(a)||a.match(/[<>'"]/g)||r.isUrl(a)||(t=r.historyLocalQuery,t&&(t._setKey({name:"pinyin"}),t.save(a,e.trim(a)),t._setKey({name:"history"})))}),r._getPinyinQuery()},_getComboEl:function(){var e,t=this;return t.menuEl||(e=t.get("caller").get("menu"),t.menuEl=e&&e.get("el")),t.menuEl},_getPinyinQuery:function(){var t=this,r=t.historyLocalQuery;r.checkFlash({onSuccess:function(){r._setKey({name:"pinyin"});var a=r.query();if(a.length>0){var s=decodeURIComponent(a[0].key);/[\u4e00-\u9fa5]/.test(s)?(t._getPinyin(a[0].key),r.clearByDay(0)):(r.clearByDay(0),r._setKey({name:"history"}),r.update(s,e.trim(s)))}r._setKey({name:"history"})},onFailure:function(){e.log("loading flashStorage failure!")}})},renderPlugin:function(){{var e,t,r=this,a=r.get("caller"),s=a.query,i=r.historyLocalQuery.query(s),n=r.get("limit");a.get("sugConfig")}""===s&&i.length>0?(a.__header={tmpl:'<div class="history-box"><a class="J_HistoryClear history-clear">\u5220\u9664\u5386\u53f2</a><span>\u6700\u8fd1\u641c\u8fc7</span></div>'},a.__footer=null,e=n):(a.__header=null,a.__footer=null,e=2),t=i.splice(0,e),t.length||(a.__header=null,a.__footer=null),a._addExtraEvent(),r._renderHistoryItems(t),r.hitedHistoryListMap[s]=t},_saveSpu:function(t){console.log(t);var r=this,a=r.historyLocalQuery,s=t.epid,i=t.query;a&&i&&(a._setKey({name:"pinyin"}),a.save(i,e.trim(i),s),a._setKey({name:"history"}),a.save(i,e.trim(i),s))},saveItemVal:function(t){var r=this,a=(r.get("caller"),t.target.get?t.target.get("el"):e.one(t.target)),s=a.attr("data-text"),i=r.historyLocalQuery,n=e.all(".search-wrap-cloud",a).attr("data-epid");r.isUrl(s)||i&&s&&(i._setKey({name:"pinyin"}),i.save(s,e.trim(s),n),i._setKey({name:"history"}),i.save(s,e.trim(s),n))},isUrl:function(e){var t=new RegExp("(http[s]{0,1}|ftp)://[a-zA-Z0-9\\.\\-]+\\.([a-zA-Z]{2,4})(:\\d+)?(/[a-zA-Z0-9\\.\\-~!@#$%^&amp;*+?:_/=<>]*)?","gi");return t.test(e)},_historyDeleteMousedown:function(e){for(var t=this,r=t.get("caller"),a=o(e.target),s=a.parent().attr("index"),i=a.parent(2),n=r.comboBox,l=n.get("menu"),u=l.get("children"),y=a.attr("data-type"),c=0;c<u.length;c++){var h=u[c];if(h.get("el")[0]===i[0]){l.removeChild(h,!0);break}}var d=t.historyLocalQuery;d&&("history"===y?d.deleteItem(s):"most"===y&&(d._setKey({name:"most"}),d.save(s,s),d._setKey({name:"history"}))),n.sendRequest(r.query),t._sendStat(s)},_sendStat:function(t){var r,a=this.get("caller"),s={},i=a.getPlugin("stat"),n=location.hostname,o="op=del&nk={nick}&src={host}&q={query}&app=sug";s.nick=a.getNick(),s.query=t,s.host=n.replace(/com|\./g,""),r=e.substitute(o,s),i&&i.send(r)},_renderHistoryItems:function(e,t){var r=this,a={},s=r.get("caller"),i=s.get("sugConfig");a.prefixCls=i.prefixCls,a.attr=t&&t.attr||"",a.extraParam=t&&t.param||"history",r._renderHTML(e,a)},_renderHTML:function(t,r){for(var a,s=this,i=s.get("caller"),n="",r=r||{},o=i.resultArr||(i.resultArr=[]),l="last-search-history",u=[],y='<div data-index="{historyIndex}" class="{prefixCls}menu-extras-history item-wrapper {lastCls}" {attr} data-key="q={historyItemValueEncode}&suggest={extraParam}_{index}" index="{historyItemValue}"><span class="{prefixCls}menu-history-key item-text">{historyItemValue}</span></div>',t=e.unique(t),c=0,h=t.length-1;h>=c;c++)0!==c&&(r.attr=""),r.index=(c+1).toString(),r.historyItemValueEncode=t[c].key,r.historyItemValue=decodeURI(t[c].key),c===h&&(r.lastCls=l),n=e.substitute(y,r),a=r.historyItemValue,u.push(a),o.push({content:n,textContent:a,unique:!0});i.historyArr=u},_getPinyin:function(t){var r=this,a="http://suggest.taobao.com/sug?code=utf-8&area=py&callback=KISSY.sug&q="+t;r._savedInputValue=decodeURIComponent(t),e.getScript(a)},_retSug:function(t){if(t&&t.result){var r=t.result[0],a=this,s=a._savedInputValue;a.historyLocalQuery&&a.historyLocalQuery.update(s,e.trim(r))}},_cleanHistory:function(){var t=this,r=t.get("caller"),a=r.comboBox,s=a.get("menu"),i=s.get("el"),n=a.get("input"),o=r.get("sugConfig"),l=o.prefixCls,u=i.one("."+l+"combobox-menu-header");t.historyLocalQuery.clearByDay(0),t.hitedHistoryListMap={};var y=u.siblings();y.css("display","none"),u.html('<div class="history-box"><span>\u641c\u7d22\u5386\u53f2\u5df2\u6e05\u7a7a</span></div>');var c=new e.Anim(i,{opacity:0},3,"easeIn",function(){y.css("display","block"),i.css({opacity:1})});c.run(),n.on("blur keydown mousedown",function(e){c.isRunning()&&c.stop(!0),r.__header=null,r.__footer=null,"keydown"===e.type&&this.value&&i.css("visibility","visible"),n.detach("blur keydown mousedown",arguments.callee)})},update:function(e){var t=this,r=encodeURI(e.sugConfig.tab);t.historyLocalQuery._setKey({tab:r}),t._getPinyinQuery()}},{ATTRS:{pluginId:{value:"history"},positionCls:{value:"no-suggest-history"},limit:{value:10,setter:function(t){return e.isNumber(t)?t:void 0}}}}),n},{requires:["base","node","dom","event","header/_7","header/p/header/history.css"]});KISSY.add("header/_7",function(e,t,a,n){function r(e){r.superclass.constructor.call(this,e||{}),this.initialize()}var i=null,s="localQueryEtao";return e.extend(r,t,{initialize:function(){var e=this,t=e.get("name"),a=e.get("tab"),n=e.get("user");"item"===a&&(a=""),e.storageKey=s+t+a+n,e._getStorage()},checkFlash:function(e){this.storage.read(e)},_setKey:function(e){var t=this,a=e.name||t.get("name"),n=e.tab||t.get("tab"),r=e.user||t.get("user");"item"===n&&(n=""),t.storageKey=s+a+n+r,t.set("tab",n),t.set("name",a),t.set("user",r),i=null},_save:function(t,a,n){if(!t.match(/<>'"/)&&!a.match(/<>'"/)){var r=this._getDatalist(),i=encodeURI(t),s={key:i,value:encodeURI(a),time:e.now()};n&&(s.epid=n),this._deleteItemByValue(r,i),r.unshift(s)}},update:function(t,a){if(!t.match(/<>'"/)&&!a.match(/<>'"/)){for(var n=this._getDatalist(),r=encodeURI(t),i=0,s=n.length;s>i;i++){var u=n[i];if(r==u.key){u.value=encodeURI(a),u.time=e.now();break}}i>=s&&this.save(t,a),this.storage.save()}},_deleteItemByValue:function(e,t){for(var a,n=null,r=0;r<e.length;r++)a=e[r].key,a==t&&(n=e.splice(r,1),r--)},_query:function(t){var a,n,r=this._getDatalist(),i=[];return t?(t=encodeURI(t),e.each(r,function(e){a=e.key,n=e.value,(0===a.indexOf(t)||0===n.indexOf(t))&&i.push(e)}),this._distinctByValue(i)):this._distinctByValue(r)},_distinctByValue:function(e){for(var t,a=[],n=0,r=e.length;r>n;n++)t=e[n],t.value.match(/%3C|%3E|[<>'"]/g)||!this._hasItemOfValue(a,t.value)&&a.push(t);return a},_hasItemOfValue:function(e,t){for(var a=!1,n=e.length-1;n>=0;n--)e[n].value===t&&(a=!0);return a},_cleanBefore:function(e){for(var t,a=this._getDatalist(),n=0,r=a.length-1;r>=0;r--)if(t=a[r],t.time>e){n=r+1;break}a.length=n},_getDatalist:function(){return i=this.storage.read()||[]},_getStorage:function(){var e=this.get("storageType");switch(e){case"flashStorage":this.storage=this._initFlashStorage();break;default:this.storage=!1}},_initFlashStorage:function(){var t=this;return{save:function(){return(new a).save(t.storageKey,e.JSON.stringify(i))},read:function(r){var i=(new a).read(t.storageKey,r);return i?e.JSON.parse(i):n}}},destructor:function(){i=null,s=null},save:function(e,t,a){if(""!=t){var n=this._save(e,t,a);return this.storage.save(),n}},query:function(e){return this._query(e)},deleteItem:function(e){var t=this._getDatalist();this._deleteItemByValue(t,encodeURI(e)),this.storage.save()},clearByDay:function(t){var a=e.now()-24*t*3600*1e3;this._cleanBefore(a),this.storage.save()},hasHistory:function(){return this._getDatalist().length>0?!0:!1}},{ATTRS:{name:{value:"default",setter:function(e){return e}},user:{value:"",setter:function(t){return e.fromUnicode(t)}},maxLength:{value:500},storageType:{value:"flashStorage",setter:function(e){return e},getter:function(e){return e}}}}),r},{requires:["base","header/_b"]});KISSY.add("header/_b",function(e,a,t){function i(e){return s||(i.superclass.constructor.call(this,e||{}),s=this,s.initialize(),window.updateLsoSaverStatus=function(){}),s}var s;return i.ATTRS={src:{value:"http://g.tbcdn.cn/tbc/search-suggest/1.3.7/storage.swf"},bridge:{value:null},hasInit:{value:!1}},e.extend(i,a,{initialize:function(a){a=a||{};var t=this;try{t._addFlash(a.appendTo),t.hasInit=!0}catch(i){e.log(i)}},_addFlash:function(e){var a,t=this,i=document,s=i.createElement("div"),o=t.get("src"),r="";s.id="storagetool",s.style.height=0,s.style.overflow="hidden",r+='<object id="J_StorageObj" name="J_StorageObj" ',r+='classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="1" height="1" ',r+='codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab">',r+='<param name="movie" value="'+o+'" />',r+='<param name="allowScriptAccess" value="always" />',r+='<embed name="J_StorageEmbed" src="'+o+'" width="1" height="1" ',r+='allowScriptAccess="always" type="application/x-shockwave-flash" ',r+='pluginspage="http://www.adobe.com/go/getflashplayer">',r+="</embed></object>",e=e||i.body,e.appendChild(s),s.innerHTML=r,-1!==navigator.appVersion.indexOf("MSIE")?(s.style.zoom=1,s.style.filter="alpha(opacity=10)",a=window.J_StorageObj):(s.style.opacity=.1,a=i.J_StorageEmbed),t.set("bridge",a)},save:function(e,a,i){var s=this,o=s.get("bridge");if(i===t&&(i=200),0!==i)try{o.save(e,a)}catch(r){setTimeout(function(){s.save(e,a,i-1)},0)}},read:function(e,a,i){var s,o=this,r=o.get("bridge");if(i===t&&(i=200),0===i)return void(a&&a.onFailure&&a.onFailure());try{return s=r.read(e),a&&a.onSuccess(s),s}catch(n){setTimeout(function(){o.read(e,a,i-1)},0)}}}),i},{requires:["base"]});KISSY.add("header/_d",function(t,a,e,r,o){function i(t){i.superclass.constructor.call(this,t||{})}return t.extend(i,a,{pluginInitializer:function(t){this._initPluginEvent.call(this,t)},tabClick:function(a){var r,o=this,i=o.get("caller"),n=a.currentTarget,s=e.attr(n,"data-searchtype"),u=e.attr(n,"data-defaulttab"),c=e.attr(n,"data-action"),l=e.attr(n,"data-suggest"),g=i.comboBox.get("input"),d=e.parent(g,"form"),f=o.get("activeCls"),b=t.all("a",n);if("_blank"==b.attr("target")){var m=b.attr("data-empty-link"),p=g[0].value;if(""===p&&m)return void b.attr("href",m)}return i.fire("beforeTabChange",{el:n})===!1?!1:(e.removeClass(e.siblings(n),f),e.addClass(n,f),i.tabNode=t.one(n),u&&d.setAttribute("data-defaulttab",u),c&&d.setAttribute("action",c),s&&(r=o.getDefCfg(s),l&&(r.sugConfig.sourceUrl=l),c&&(r.action=c),i.update(r)),i.fire("afterTabChange",{el:n}),void a.preventDefault())},_initPluginEvent:function(a){var e=this,o=e.get("activeCls"),i=e.get("node")||a.get("sugConfig").tablist;e.set("caller",a);var n,s=a.comboBox,u=s.get("input"),c=u.parent("form");i&&(r.on(i,"click",e.tabClick,e),t.all(i).each(function(t){t.hasClass(o)&&(a.tabNode=t,n=t.attr("data-action"),n&&c.attr("action",n))}))},update:function(a){var r,i,n,s=this,u=s.get("caller"),c=u.comboBox,l=a.sugConfig.tab,g=u.configArr[l],d=a.sugConfig,f=c.get("input"),b=e.parent(f,"form");u.configArr=u.configArr||[],i=u.get("dataSourceCfg"),n=i.xhrCfg,n.url=d.sourceUrl,t.mix(u.__attrVals,a,{deep:!0}),u.__attrVals.mods.sort=a.mods.sort,g?r=g.data:g=u.configArr[l]=""===n.url?{data:new o.LocalDataSource({data:{},parse:i.parse})}:{data:new o.RemoteDataSource(i)},c.set("dataSource",g.data),b&&e.attr(b,"action",a.action),f[0].focus(),c.sendRequest(u.query)},getDefCfg:function(a){var e;switch(a){case"item":e={sugConfig:{sourceUrl:"http://suggest.taobao.com/sug?area=etao_new&k=1",resultFormat:"",tab:"item",excludeParam:["q"]},mods:{sort:["history","list","cloud"],list:{tmpl:'<div data-index="{index}" class="item-wrapper" data-key="q={query}{text}&suggest=0_{index}"><span class="item-text">{query}<b>{text}</b></span><span class="item-count">{format}</span></div>'},showExtra:!1},action:"http://s.etao.com/search"};break;default:if(!t.isObject(a))return void t.log("\u914d\u7f6e\u6709\u8bef");e=a,e.sugConfig||(e.sugConfig={})}return e.sugConfig&&!e.sugConfig.tab&&(e.sugConfig.tab=e.sugConfig.sourceUrl),e}},{ATTRS:{pluginId:{value:"tab"},caller:{value:null}}}),i},{requires:["base","dom","event","combobox"]});KISSY.add("header/_1",function(e,t,a,r,i,n){function o(e){o.superclass.constructor.call(this,e||{})}var l=r.all,d="_blank"==l(".search-form").attr("target")?"_blank":"_self";return e.extend(o,t,{pluginInitializer:function(e){var t=this,a=e.comboBox,r=!1;t.set("caller",e),t.MIN_WIDTH=t.get("min_width"),t.CHANNEL_WIDTH=t.get("searchbox_min_width"),t.comboEl=a.get("el"),t.narrowCls=t.get("narrowCls"),a.on("beforeShow",function(){}),e.comboBox.on("afterRenderUI",function(){t.renderCloud()}),e.on("afterCollapsedChange",function(i){var o=e.get("menu");if(o.get&&!r){r=!0,t.initKeyEvent();var d=o.get("el");d.delegate("click",".cloud-footer",function(){var e=l(".search-menu-item-hover",d),t=l(".search-wrap-cloud",e),r=t.attr("data-epid"),i=t.attr("data-text");a.fire("afterClickCloud",{epid:r,query:i})}),o.on("afterHighlightedChange",function(e){var a=e.target,r=a.get("el"),i=l(".search-wrap-cloud",r).attr("data-epid");l(a).hasClass("search-menu-item-hover")&&(i||t._hideCloud())})}t._resetDimension(),i.newVal||t._setMenuWidth(),window.initMenu||l(".search-menu")&&(window.initMenu=!0,t.menu=new n({wrap:".search-menu",menu:".search-contentbox,.search-menu-content",rows:".search-menuitem",cls:".search-wrap-cloud",tolerance:600,handler:{enterHandler:function(e){t._showCloud(e)},leaveHandler:function(e){t._hideCloud(e)}}}))})},initKeyEvent:function(){var t=this,a=t.get("caller"),n=a.comboBox,o=i.KeyCodes||r.KeyCode;n.on("beforeKeyDown",function(i){var l=this.get("menu");if(l.get){var d,s,u,c,h=i.event,g=l.get("highlightedItem"),m=l.get("children"),v=m.length;if(0===v)return void 0;switch(h.keyCode){case o.ENTER:var p=t.isShowMagic()||t.isShowItem();return p&&(p.click(),h.halt()),!1;case o.UP:case o.DOWN:var f,_;h.keyCode===o.UP?(_=v-1,f=-1):(_=0,f=1),t.isTriggerArrowKey=!0,g?(d=e.indexOf(g,m),s=(d+f+v)%v):s=_;var p=t.isShowBrandMagic();if(p)return t.topDirectionEvent(h),!1;var w=r.one(".cloud-link-wrap-hover");return w&&w.removeClass("cloud-link-wrap-hover"),0===d&&-1===f||d===v-1&&1===f?(t._hideCloud(),l.set("highlightedItem",null),n._stopNotify=1,a.get("input").val(n._savedInputValue||n._savedValue),!1):(u=l._getNextEnabledHighlighted(s,f),l.set("highlightedItem",u),t._showCloud(u.get("el")[0]),n._stopNotify=1,c=u.get("textContent"),n.setValueFromAutocomplete?n.setValueFromAutocomplete(c):(n._stopNotify=1,a.get("input").val(c)),n.fire("beforeSetInputValue",{event:h}),!1);case o.HOME:case o.END:return u=h.keyCode===o.END?l._getNextEnabledHighlighted(v-1,-1):l._getNextEnabledHighlighted(0,1),l.set("highlightedItem",u),t._showCloud(u.get("el")[0]),n.setValueFromAutocomplete?n.setValueFromAutocomplete(u.get("textContent")):(n._stopNotify=1,a.get("input").val(u.get("textContent"))),!1;default:t.directionEvent(h)}}})},redirect:function(e,t){var a=document.createElement("a"),t=t||"_self";a.setAttribute("href",e),a.setAttribute("target",t),a.style.display="none",document.body.appendChild(a),a.click()},isShowMagic:function(){var e,t,r,i=l(".cloud-item-list");return i.each(function(t){"none"!==a.css(t,"display")&&(e=t)}),e?(t=a.query(".cloud-link-wrap-hover")[0],t&&(r=a.query("a",t)[0]||t),r):void 0},isShowBrandMagic:function(){var e,t,r,i=l(".J_SearchCBrand");return i.each(function(t){"none"!==a.css(t,"display")&&(e=t)}),e?(t=a.query(".cloud-link-wrap-hover")[0],t&&(r=a.query("a",t)[0]),r):void 0},isShowItem:function(){var e=this;return e.isTriggerArrowKey&&a.get(".search-menu-item-hover")},directionEvent:function(e){var t,a,n,o,l,d,s=this,u=i.KeyCodes||r.KeyCode;switch(e.keyCode){case u.RIGHT:case u.LEFT:if(d=s.get("caller").get("menu"),t=d.get("activeItem")||d.get("highlightedItem"),!t)return!0;if(a=t.get("el").one(".item-wrapper"),!a)return!0;if(n=a.attr("data-index"),!n)return!0;if(o=r.one("#J_CloudList"+n),!o)return!0;var c=o.one(".cloud-link-wrap-hover");if(o.hasClass("J_SearchCBrand")&&c)return c.removeClass("cloud-link-wrap-hover"),!0;l=s.getHighLightItem(o,!!(e.keyCode-u.LEFT),!!(e.keyCode-u.LEFT)),l.node&&l.node.addClass("cloud-link-wrap-hover"),l.last&&l.last.removeClass("cloud-link-wrap-hover")}},topDirectionEvent:function(e){var t,a,n,o,l,d,s=this,u=i.KeyCodes||r.KeyCode;switch(e.keyCode){case u.UP:case u.DOWN:if(d=s.get("caller").get("menu"),t=d.get("activeItem")||d.get("highlightedItem"),!t)return!0;if(a=t.get("el").one(".item-wrapper"),!a)return!0;if(n=a.attr("data-index"),!n)return!0;if(o=r.one("#J_CloudList"+n),!o)return!0;l=s.getHighLightItem(o,!!(e.keyCode-u.UP)),l.node&&l.node.addClass("cloud-link-wrap-hover"),l.last&&l.last.removeClass("cloud-link-wrap-hover")}},getHighLightItem:function(e,t){var a=e.one(".cloud-link-wrap-hover"),r=t?"next":"prev";if(a){var i=a[r]();if(!i){var n=e.all(".J_CloudItem");i=l(t?n[0]:n[n.length-1])}return{node:i,last:a}}return{node:e.one(".J_CloudItem"),last:null}},checkRender:function(e){var t=e.comboBox,a=e.query,r=t.get("dataSource"),i=r.extraData[a],n=e.resultArr;return""!==a&&i?{extra:i,query:a,results:n}:{extra:[],query:"",results:n}},renderPlugin:function(){var t=this,a=t.get("caller"),r=t.checkRender(a);if(!r)return!1;var i,n,o,l,d,s,u=r.extra,c=r.results,h=r.query;t.isFirstShow=!1,i=e.clone(u.box);for(var g=0,m=c.length-1;m>=g;g++)if(n=c[g],i=i||[],i.length)for(var v in i){if(d=n.content,o=d.match(/data-index="(\w+)"/),l=d.match(/data-key="([\S\s]+?)"/),!o||!o[1])break;o=o[1]-0,l&&l[1]&&(l=l[1]),o==i[v].index&&(s=i[v],t._renderHTML({result:n,box_type:s.box_type,data:s.value,query:h,index:o,key:l}),t.isCloudRendered=!1),t.isTriggerArrowKey=!1}},renderCloud:function(){var t=this;if(!t.isCloudRendered){t.isCloudRendered=!0;var a=t.get("caller"),r=t.checkRender(a);if(!r)return!1;var i,n,o,l,d,s,u,c="",h=r.extra,g=r.results,m=r.query;i=e.clone(h.box);for(var v=0,p=g.length-1;p>=v;v++)if(n=g[v],i=i||[],i.length)for(var f in i){if(d=n.content,o=d.match(/data-index="(\w+)"/),l=d.match(/data-key="([\S\s]+?)"/),!o||!o[1])break;o=o[1]-0,l&&l[1]&&(l=l[1]),o==i[f].index&&(1===o&&(u=!0),s=i[f],c+=t._renderCloud({result:n,box_type:s.box_type,data:s.value,query:m,index:o,key:l}))}var _={tmpl:'<div class="cloud-box">'+c+"</div>",type:"cloud"};t.isShowFirstItem=u?!0:!1,a.__footer=_,a._addExtraEvent()}},_resetDimension:function(){var e=this,t=e.get("caller").get("menu").get("el"),a=r.one(".J_CHotSearch");(!a||a&&"none"===a.css("display"))&&t.css({height:""}),e._setMenuWidth()},_setMenuWidth:function(){var e=this,t=e.get("caller").get("menu").get("el"),a=e.comboEl.width(),r=l("#J_searchbox"),i=r.width(),n=i-43;a<e.CHANNEL_WIDTH&&(i<e.MIN_WIDTH?(t.addClass(e.narrowCls),n=e.MIN_WIDTH):(n=i-3,t.removeClass(e.narrowCls))),t.width(n)},_hideCloud:function(){var e=this;l(".cloud-footer").hide(),l(".search-menu-item-hover").removeClass("search-menu-item-hover"),e._resetDimension()},_showCloud:function(e){var t=this,a=t.get("caller"),r=l(".search-wrap-cloud",e),i=r.attr("data-epid"),n=r.attr("data-index"),o=t._getComboEl(),d=l(".cloud-footer",o);if(l(".search-menu-item-hover",o).removeClass("search-menu-item-hover"),l(e).addClass("search-menu-item-hover"),t.lastItemIndex){var s=l("#J_CloudList"+t.lastItemIndex);s&&s.hide(),d&&d.hide()}t.lastItemIndex=n;var u=l("#J_CloudList"+n);if(o)if(i&&!u.attr("data-updated"))t._setMenuWidth(),t._resetHeight(),d.show().removeClass("load-done"),t._fetchSpu(e);else if(u.length){l(".cloud-footer",o).show().addClass("load-done");var c=u[0].className;u.show(),c.indexOf("J_SearchCtags")>-1&&(a.fire("afterShowTags"),o.height(""),t.setPadding(l(e),u)),c.indexOf("J_SearchCBrand")>-1&&(a.fire("afterShowBrand"),o.height(t.get("brandMinHeight")))}},setPadding:function(e,t){var a=this,r=t.one(".cloud"),i=this.getPadding(e,t),n=a.get("align");n&&i&&r.css("paddingTop",i)},getPadding:function(e,t){var a=32,r=l(".search-menu"),i=t.one(".cloud"),n=r.offset().top,o=e.offset().top,d=o-n,s=r.height(),u=i.height(),c=d-a,h=s-u-c-15;return c>0?(0>h&&(c-=36*Math.round(-h/36)),10>s-c-u&&(c-=10),d>c+u&&(c=s-u),c):void 0},_getComboEl:function(){var e,t=this;return t.menuEl||(e=t.get("caller").get("menu"),t.menuEl=e&&e.get("el")),t.menuEl},_fetchSpu:function(t){var r,i=this,n=t,o=l(".search-wrap-cloud",t),d=o.attr("data-epid").split(","),s=o.attr("data-text"),u=l(".search-wrap-cloud",t).attr("data-index"),c=i.get("caller"),h=l(".cloud-footer"),g=Math.min(d.length,2),m=l("#J_searchbox");m.width()<i.CHANNEL_WIDTH&&(g=1);for(var v=0;g>v;v++){var r=d[v],p="http://s.etao.com/item/"+r+".html?from=QuerySuggest&renderType=jsonp&n=1&suggest_type=1 ";!function(r,o){new e.IO({url:o,dataType:"jsonp",scriptCharset:"utf-8",jsonp:"jsonpcallback",success:function(r){if(l(".search-menu-item-hover")[0]==t){r.queryText=s;var o=i._handleSpuData(r);o.index=u;var d=e.substitute(i.get("item_tmpl"),o),g=a.query(".item-wrapper",n)[0];if(g&&h){var m=g.getAttribute("data-index"),v=l("#J_CloudList"+m);l(".cloud",v).append(d),v.attr("data-updated",!0).show(),h.addClass("load-done"),i._setMenuWidth();var p=c.get("menu").get("el"),f=p.height(),_=v.one(".cloud");if(_){var w=_.height()+30;w>f&&p.height(w)}c.fire("afterShowSpu")}}}})}(r,p)}},_resetHeight:function(){var e=this,t=e._getComboEl(),a=e.get("cloudMinHeight");t&&t.height()<a&&t.height(a)},_handleSpuData:function(e){var t=this,a=e.spuInfo,r=e.b2cItems,i=r&&r[0];if(i){if(!i.nid)return;var n="http://s.etao.com/detail/"+i.nid+".html";a.link=n+"?initiative_id=setao_"+t._getTodayDate()+"&word="+e.queryText+"&suggest_prd=2&suggest_type=1",a.image=e.spuInfo&&e.spuInfo.image+"_110x110.jpg",a.url=i.url,a.price=i.price,a.siteName=i.siteName,a.title=i.title}return a},_getTodayDate:function(){var e=new Date,t=e.getMonth()+1,a=e.getDate();return 10>t&&(t="0"+t),10>a&&(a="0"+a),e.getFullYear()+""+t+a},_renderHTML:function(e){var t,a=e.result,r=e.data,i=(e.index,e.box_type),n="";"epid_zhida"===i&&(t=r,n="suggest_type=1"),"epid_multi_zhida"===i&&(t=r.join(","),n="suggest_type=1"),"magic"===i&&(n="suggest_type=5"),"top_brand_list"===i&&(n="suggest_type=2");var o=t?'data-epid="'+t+'"':"";e.key+="&"+n,a.content='<div class="search-wrap-cloud" data-index="'+e.index+'"'+o+' data-key="'+e.key+'"data-text="'+a.textContent+'">'+a.content+"</div>"},_renderCloud:function(t){var a,r=this,i=t.result,n={},o=t.data,l=t.query,d=t.index,s=t.box_type,u=i.content,c=window.location.host,h=c.substring(0,c.indexOf(".")),g="";if("www"===h&&(g="&spm=1002.1.8.1"),!o)return"";var m=r.get(r.get("tmplMap")[s]);return m?("magic"==s&&(n.title=a=u.replace(/<(\s|\S)+?>/g,""),n.list=r._dealData({arr:o,data:{title:a,wq:l,index:d,spm:g},tmpl:r.get("liTmpl")})),"top_brand_list"==s&&(n.title=a=u.replace(/<(\s|\S)+?>/g,""),n.list=r._dealData({arr:o,data:{title:a,wq:l,index:d,spm:g},tmpl:r.get("brand_li_tmpl")})),n.index=d,e.substitute(m,n)):void 0},_dealData:function(t){var a,r=t.tmpl,i=t.arr,n=t.data,o="";i.length>10&&i.splice(10);for(var l=0,d=i.length-1;d>=l;l++)for(var s=0,u=i[l].length-1;u>=s;s++)n.tag=a=i[l][s].title.replace(/<b>(\S+)\<\/b>/,function(e,t){return t}),n.index2=l+1,n.query=n.title+" "+a,n.text=i[l][s].title,o+=e.substitute(r,n);return o},sort:function(e){Array.prototype.sort.call(e,function(){return Math.random()>.5?-1:1})}},{ATTRS:{pluginId:{value:"cloud"},limit:{value:3,setter:function(t){return e.isNumber(t)?t:void 0}},tmplMap:{value:{epid_zhida:"spu_tmpl",epid_multi_zhida:"spu_tmpl",magic:"magic_tmpl",top_brand_list:"brand_tmpl"}},spu_tmpl:{value:' <div id="J_CloudList{index}" data-index="{index}" class="cloud-item-list J_SearchCSpu"><div class="cloud clearfix"><h4>\u4e00\u6dd8\u5e2e\u4f60\u9009</h4></div></div>'},brand_tmpl:{value:' <div id="J_CloudList{index}" data-index="{index}" class="cloud-item-list J_SearchCBrand s-sort-list hot-search-brand "><div class="cloud clearfix"><div class="hs-hd">\u70ed\u9500\u54c1\u724c\u6392\u884c\u699c</div><div class="J_HotSearchContent1 hs-bd"><ul>{list}</ul></div></div></div>'},magic_tmpl:{value:'<div id="J_CloudList{index}" data-index="{index}" class="cloud-item-list cloud-tags J_SearchCtags"><div class="cloud clearfix"><h4>\u5927\u5bb6\u90fd\u5728\u770b</h4> <div class="cw-words"><ul class="cw-line clearfix">{list}</ul></div></div> </div>'},brand_li_tmpl:{value:'<li class="s-hot-brand s-cloud-item J_CloudItem"><a target="'+d+'" href="http://s.etao.com/search?q={query}&wq={wq}&source=suggest&suggest_prd=2&suggest_type=2{spm}">{index2}.{text}</a></li>'},liTmpl:{value:'<li class="cw-word J_CloudItem"><a class="cloud-link" target="'+d+'" href="http://s.etao.com/search?q={query}&wq={wq}&source=suggest&suggest_prd=2&tag={tag}&suggest_type=5{spm}"  class="cloud-link"><span>{text}</span></a></li>'},item_tmpl:{value:'<a class="cloud-addr clearfix J_CloudItem" href="{link}" target="'+d+'"><div class="cloud-image-wrap"><img src="{image}"/></div><div class="cl-title">{title}</div><div class="cl-info clearfix"><span class="cl-price">{price}\u5143</span><span  class="cl-seller">{siteName}</span></div></a>'},narrowCls:{value:"narrow-combox"},cloudMinHeight:{value:250},brandMinHeight:{value:300},min_width:{value:484},searchbox_min_width:{value:600},align:{value:!0}}}),o},{requires:["base","dom","node","event","header/_8","header/_a","header/p/header/cloud.css"]});KISSY.add("header/_8",function(e,t){var n=t.all,r=function(t){var o=this;o.opts=e.mix(r.defs,t),o.$wrap=n(o.opts.wrap),o.$menu=n(o.opts.menu),o.locs=[],o.rNow=null,o.tOut=null,o.init()};return r.defs={wrap:"",menu:"",rows:"",dealy:300,handler:null,tolerance:0},r.prototype.getOffset=function(){var e=this,t=e.opts,n=e.$menu,r=n.offset();e.menuOffset=r,e.upperRight={x:r.left+n.outerWidth(),y:r.top-t.tolerance},e.lowerRight={x:r.left+n.outerWidth(),y:r.top+n.outerHeight()+t.tolerance}},r.prototype.bindEvent=function(){var e,t,r,o=this,u=o.opts,l=o.locs,a=o.rNow,i=o.tOut,f=null,s=function(i){function s(e,t){return(t.y-e.y)/(t.x-e.x)}var c=!!n(i).one(u.cls);o.getOffset(),e=o.menuOffset,t=o.upperRight,r=o.lowerRight;var p=l[l.length-1],h=l[0];if(!a||!p)return 0;if(h.x<e.left||h.x>r.x||h.y<e.top||h.y>r.y)return 0;if(f&&p.x==f.x&&p.y==f.y)return 0;var d=s(p,t),g=s(p,r),y=s(h,t),m=s(h,r);return c&&y>d&&g>m?(f=p,u.dealy):(f=null,0)},c=function(e){a!=e&&(u.handler.enterHandler(e),a=e)},p=function(e,t){o.isDelay=t?!0:!1;var n=s(t);n?i=setTimeout(function(){p(o.currentTarget,o.currentTarget)},n):(o.isDelay=!1,c(e))},h=function(e){l.push({x:e.pageX,y:e.pageY}),l.length>3&&l.shift()},d=function(){a=null,u.handler.leaveHandler()},g=function(){o.isDelay=!1,a=null,i&&clearTimeout(i)},y=function(e){if(o.currentTarget=e.currentTarget,!o.isDelay){i&&clearTimeout(i);var t=e.relatedTarget,r=n(t).parent(u.rows);p(e.currentTarget,r)}};o.$wrap.on("mousemove",h).on("mouseleave",d),o.$menu.on("mouseleave",g).delegate("mouseenter",u.rows,y)},r.prototype.init=function(){this.getOffset(),this.bindEvent()},r},{requires:["node","event"]});KISSY.add("header/_a",function(s,t){function e(s){e.superclass.constructor.call(this,s||{})}return e.ATTRS={pluginId:{value:"stat"},f_stats_show:{value:"f_stats_show=suggest_fc_show:1"},stats_click:{suggest_auc:"suggest_auc=1",suggest_prd_1:"suggest_prd=1",suggest_prd_2:"suggest_prd=1",suggest_type_1:"suggest_type=1",suggest_type_2:"suggest_type=1",suggest_type_3:"suggest_type=1",suggest_type_4:"suggest_type=1",suggest_type_5:"suggest_type=1",suggest_type_6:"suggest_type=1"}},s.extend(e,t,{pluginInitializer:function(s){var t=this;t.set("caller",s),t.bindStatShow()},bindStatShow:function(){{var s=this,t=s.get("caller");t.comboBox,s.get("stats_show")}},send:function(s,t){var e,g;t?(e="/tongji",g="H51884970"):(e="/search",g="H51884969"),(window.goldlog_queue||(window.goldlog_queue=[])).push({action:"goldlog.record",arguments:[e,"",s,g]})}}),e},{requires:["base","cookie","event"]});KISSY.add("header/_4",function(e,t,r,s,a){function o(e){o.superclass.constructor.call(this,e||{})}var n=e.all,i="_blank"==n(".search-form").attr("target")?"_blank":"_self";return e.extend(o,t,{pluginInitializer:function(e){var t=this;t.set("caller",e),t.resultArr=[],t._bindRelaventEvents()},_bindRelaventEvents:function(){var e=this,t=e.get("caller");t.on("afterQueryChange",function(){e._handleHotSearch()}),t.comboBox.on("afterRenderUI",function(){var t=e.get("caller"),r=e.get("positionCls"),s=e._getComboEl(),a=n(".search-menuitem",s).length;e._removeHeight(),t.query?(s&&s.removeClass(r),e.hideHotSearch()):(n(".last-search-history").removeClass("last-search-history"),a>=5&&!e.hasNoHistory?(s&&s.addClass(r),e._showHotSearch(a),e._removeHeight()):(s&&s.removeClass(r),e.hideHotSearch()))})},_handleHotSearch:function(){var e=this,t=e.get("caller"),r=e.get("positionCls"),s=e._getComboEl(),a=t.resultArr.length;t.query||a>=5&&!e.hasNoHistory&&(s&&s.addClass(r),e._showHotSearch(a))},_sendStat:function(){var e=this.get("caller"),t=e.getPlugin("stat"),r="f_stats_show=magic:1";t&&t.send(r,!0)},_getComboEl:function(){var e=this;return e.menuEl||(e.menuEl=e.get("caller").get("menu").get&&e.get("caller").get("menu").get("el")),e.menuEl},checkRender:function(e){var t=e.comboBox,r=e.query,s=t.get("dataSource"),a=s.extraData[r],o=e.resultArr;return""!==r&&a?{extra:a,query:r,results:o}:{extra:[],query:"",results:o}},renderPlugin:function(){var e=this,t=e.get("caller"),r=e.checkRender(t);return e.hasNoHistory=!1,r?void(""===r.query&&0===r.results.length&&e._showSearchSuggest()):!1},_showSearchSuggest:function(){var t=this,r=t.get("caller"),s=r.resultArr||(r.resultArr=[]),o=t.resultArr,n=a.hotSearchList.tmpl;if(o&&o.length){var i=window.location.host,l=i.substring(0,i.indexOf(".")),h="";"www"===l&&(h="&spm=1002.1.8.1"),r.__header={tmpl:'<div class="hs-hd">\u4eca\u65e5\u5173\u6ce8\u4e0a\u5347</div>'},r._addExtraEvent();for(var u=0,c=o.length;c>u;u++)s.push({content:e.substitute(n,{extra:"&suggest_type=4",query:o[u].OBJECT_NAME,text:o[u].OBJECT_NAME,encodeText:encodeURI(o[u].OBJECT_NAME),index:u+1,spm:h}),textContent:o[u].OBJECT_NAME});t.hasNoHistory=!0,r.fire("hotSearchWithNoHistory")}},_showHotSearch:function(t){var r,s=this,a=s._getComboEl(),o=s.get("tmpl"),n=s.get("liTmpl"),i=(s.get("minHeight"),s.get("wrapCls"));t=t||10;var l=window.location.host,h=l.substring(0,l.indexOf(".")),u="";if("www"===h&&(u="&spm=1002.1.8.1"),a){a.css("height","");for(var c,g=s.resultArr,d={},v="",_=0,t=Math.min(g.length,t);t>_;_++)c=g[_].OBJECT_TITLE||g[_].OBJECT_NAME,d.query=c,d.text=c,d.encodeText=encodeURI(c),d.wq=c,d.index=_+1,d.spm=u,v+=e.substitute(n,d);var m={list:v};r=e.substitute(o,m),e.all("."+i).remove(),a.append(r).show()}},hideHotSearch:function(){n("."+this.get("wrapCls")).hide()},_removeHeight:function(){var e=this,t=e._getComboEl();t&&t.css("height","")},_resetHeight:function(){var e=this,t=e._getComboEl(),r=e.get("minHeight");t&&t.height()<r&&t.height(r)},_fetchRank:function(){var t,r=this,s=r.get("caller"),a=s.resultArr||(s.resultArr=[]),o=r.get("api");e.getScript(o,{success:function(){if(window.top_data){r.resultArr=top_data.cat_toprank.toprank_list.toprankid_TR_zongbang.data,t=r.resultArr;for(var e=0,s=Math.min(t.length,10);s>e;e++)a.push({content:t[e].OBJECT_NAME,textContent:t[e].OBJECT_NAME})}}})}},{ATTRS:{pluginId:{value:"hot-search"},api:{value:""},wrapCls:{value:"J_CHotSearch"},positionCls:{value:"no-suggest-history"},minHeight:{value:280},limit:{value:3,setter:function(t){return e.isNumber(t)?t:void 0}},tmpl:{value:'<div class="J_CHotSearch s-sort-list hot-search "><div class="hs-hd">\u4eca\u65e5\u5173\u6ce8\u4e0a\u5347</div><div class="hs-bd"><ul>{list}</ul></div> </div>'},liTmpl:{value:'<li><a target="'+i+'" href="http://s.etao.com/search?q={encodeText}&wq={wq}&source=suggest&suggest_prd=2&suggest_type=3{spm}">{index}.{text}</a></li>'}}}),o},{requires:["base","dom","event","header/_9","header/p/header/hot-search.css"]});KISSY.add("header/_e",function(e,t){function r(e){r.superclass.constructor.call(this,e||{})}e.all;return e.extend(r,t,{pluginInitializer:function(e){var t=this;t.set("caller",e),t.resultArr=[]},checkRender:function(e){var t=e.comboBox,r=e.query,a=t.get("dataSource"),n=a.extraData[r],s=e.resultArr;return""!==r&&n?{extra:n,query:r,results:s}:{extra:[],query:"",results:s}},renderPlugin:function(){var t=this,r=t.get("caller"),a=t.checkRender(r);if(!a)return!1;var n,s=a.extra,u=a.results,i=a.query;t.isFirstShow=!1,n=e.clone(s.wanke_extra),n&&n[0]&&(n[0].link=e.trim(n[0].link),u.push({content:e.substitute(t.get("tmpl"),n[0]),textContent:i,unique:!0}))}},{ATTRS:{pluginId:{value:"wanke"},tmpl:{value:'<div data-target="_blank" data-action="{link}?suggest_fc_show=8" class="suggest-extra item-wrapper" data-text="{query}{text}" data-key=""><span class="item-text">\u73a9\u5ba2: {content}</span></div>'}}}),r},{requires:["base","node","dom","event"]});KISSY.add("header/_3",function(e,t,r){function l(e){l.superclass.constructor.call(this,e||{})}var a=r.all;return e.extend(l,t,{pluginInitializer:function(e){var t=this;t.set("caller",e),t.resultArr=[],t._bindRelaventEvents()},_bindRelaventEvents:function(){var t=this,r=t.get("caller"),l=t.get("minHeight"),a=t.get("wrapCls");r.comboBox.on("afterRenderUI",function(){var r=t._getComboEl();e.all("."+a).height(r&&r.height()<l?l:r.height())})},_getComboEl:function(){var e=this;return e.menuEl||(e.menuEl=e.get("caller").get("menu").get&&e.get("caller").get("menu").get("el")),e.menuEl},_handleHotSearch:function(){var e=this,t=e.get("caller"),r=e.get("positionCls"),l=e._getComboEl();t.query&&(l&&l.addClass(r),e._resetHeight())},_removePostionCls:function(){var e=this,t=(e.get("caller"),e.get("positionCls")),r=e._getComboEl();r&&r.removeClass(t)},_sendStat:function(){var e=this.get("caller"),t=e.getPlugin("stat"),r="f_stats_show=magic:1";t&&t.send(r,!0)},_getComboEl:function(){var e=this;return e.menuEl||(e.menuEl=e.get("caller").get("menu").get&&e.get("caller").get("menu").get("el")),e.menuEl},checkRender:function(e){var t=e.comboBox,r=e.query,l=t.get("dataSource"),a=l.extraData[r],n=e.resultArr;return""!==r&&a?{extra:a,query:r,results:n}:{extra:[],query:"",results:n}},renderPlugin:function(){var t,r=this,l=r.get("caller"),n=r.checkRender(l),s=n.extra,i=n.query;return r.hasNoHistory=!1,a(".J_CHotSearchBrand").remove(),r._removePostionCls(),n?(t=e.clone(s.top_brand_extra),void(t&&r._showHotSearch(t[0].content,i))):!1},_showHotSearch:function(t,r){var l,a=this,n=a._getComboEl(),s=a.get("tmpl"),i=a.get("liTmpl"),o=(a.get("minHeight"),a.get("wrapCls"));p=Math.min(t.length,10);var h=window.location.host,g=h.substring(0,h.indexOf(".")),u="";if("www"===g&&(u="&spm=1002.1.8.1"),n){n.css("height","");for(var c,d=t,m={},v="",_=0,p=Math.min(d.length,p);p>_;_++)c=d[_],m.query=r,m.text=c,m.wq=r+" "+c,m.index=_+1,m.spm=u,v+=e.substitute(i,m);var f={list:v};l=e.substitute(s,f),e.all("."+o).remove(),n.append(l).show(),a._handleHotSearch()}},_removeHeight:function(){var e=this,t=e._getComboEl();t&&t.css("height","")},_resetHeight:function(){var t=this,r=t._getComboEl(),l=t.get("minHeight"),a=t.get("wrapCls");r&&r.height()<l?(r.height(l),e.all("."+a).height(l)):e.all("."+a).height(r.height())}},{ATTRS:{pluginId:{value:"hot-search-brand"},wrapCls:{value:"J_CHotSearchBrand"},positionCls:{value:"hot-search-brand"},minHeight:{value:280},tmpl:{value:'<div class="J_CHotSearchBrand s-sort-list hot-search "><div class="hs-hd">\u70ed\u9500\u54c1\u724c\u6392\u884c\u699c</div><div class="hs-bd"><ul>{list}</ul></div> </div>'},liTmpl:{value:'<li><a target="_self" href="http://s.etao.com/search?q={query}{text}&wq={wq}&source=suggest&suggest_prd=2&suggest_type=9{spm}">{index}.{text}</a></li>'}}}),l},{requires:["base","node","dom","event","header/_9"]});var ETao=ETao||{};KISSY.add("header/_0",function(t,e,o){function i(){this.initialize()}var n=(window,document),a={getCookie:function(t){var e=n.cookie.match("(?:^|;)\\s*"+t+"=([^;]*)");return e&&e[1]?decodeURIComponent(e[1]):""},escapeHTML:function(t){var e=n.createElement("div"),o=n.createTextNode(t);return e.appendChild(o),e.innerHTML},getEnv:function(){var t=n.domain,e="dev";return-1!=t.indexOf("daily.etao.net")&&(e="daily"),-1!=t.indexOf("etao.com")&&(e="online"),e},render:function(t,e){return t.replace(/{([^}]+)}/g,function(t,o){return e[o]})},IE6Hover:function(i,n){var a=!!(t.UA.ie<7);a&&i&&(n=n||"hover",i=e.get(i),o.on(i,"mouseenter",function(){e.addClass(this,n)}),o.on(i,"mouseleave",function(){e.removeClass(this,n)}))},initAria:function(t){if(t=e.get(t)){var i=e.children(t,"a")[0];o.on(i,"keydown",function(o){27==o.keyCode&&(o.halt(!0),e.removeClass(t,"hover")),40==o.keyCode&&(o.halt(!0),e.addClass(t,"hover"))}),o.on(t,"mouseleave",function(){e.hasClass(t,"hover")&&e.removeClass(t,"hover")})}}},s={_dailyConfig:{xmppCfg:{ctype:"login",appId:"1061"},xmppScript:"http://g.assets.daily.taobao.net/tbc/umpp/1.4.30/index.js",msg:{refLink:"http://i.daily.etao.net/message/list.html?from=nav"},score:{refLink:"http://fanli.daily.etao.net/my/user_rebate.htm"},level:{refLink:"http://i.daily.etao.net/level/user_level.html"},fetchAPI:"http://i.daily.etao.net/api/fmsg2.html",domain:"daily.etao.net"},_config:{xmppCfg:{ctype:"login",appId:"1061"},xmppScript:"http://g.tbcdn.cn/tbc/umpp/1.4.30/index-min.js",msg:{refLink:"http://i.etao.com/message/list.html?from=nav",activeCls:"msg-info-active",closedCookie:"closemess",countContainer:"J_MsgCount",listContainer:"J_MsgList",stat:{through:"syn_show=message:through",nothrough:"syn_show=message:nothrough"}},score:{refLink:"http://rebate.etao.com/my/index.htm",countContainer:"J_ScoreCount"},level:{refLink:"http://i.etao.com/level/user_level.html",usrInfoCls:"login-info-usr",usrLevelCls:"login-info-usr-level"},zeroCls:"msg-count-zero",fetchAPI:"http://i.etao.com/api/fmsg2.html",domain:"etao.com"},_adjust:function(){var e=this,o=window.location.host.indexOf("daily.etao.net")>-1;return o&&t.mix(e._config,e._dailyConfig,!0,null,!0),e._config},init:function(t){if(t){var e,o=this,i=o._adjust(),n="",s=a.getCookie("tracknick");o._render=a.render,i.msg.refLink&&i.score.refLink&&(o.createUI(),e=o._getCountForce(),e&&e[1]&&1==e[1]?(n=decodeURIComponent(e[4]||""),n!==s?o.fetchNewMsg({mpp_sub_type:-1}):(o._updateCount(o.msgCount,e[0]),o._updateCount(o.scoreCount,e[2]))):o.fetchNewMsg({mpp_sub_type:-1}))}},register:function(e){var o=this,i=o._adjust();t.getScript(i.xmppScript,function(){t.config({packages:[{name:"tbc",path:"http://g.tbcdn.cn/",charset:"utf-8",debug:!0}]}),t.use("tbc/umpp/1.4.30/",function(t,n){e&&setTimeout(function(){n.register(i.xmppCfg.appId,function(t){o._notify(t)})},0)})})},createUI:function(){var o=this,i=o._config,n=t.one("#J_MyLogin");o.msgInfo=e.create("<div/>",{"class":"etao-nav-item msg-info"}),o.scoreInfo=e.create("<div/>",{"class":"etao-nav-item score-info"}),o._createMsgUI()._createScoreUI(),e.insertAfter(o.msgInfo,n),e.insertAfter(o.scoreInfo,o.msgInfo),o.msgCount=e.get("#"+i.msg.countContainer),o.msgList=e.get("#"+i.msg.listContainer),o.scoreCount=e.get("#"+i.score.countContainer)},_createScoreUI:function(){var t=this,o=t._config,i='<a href="{link}" target="_self"><b>{text}</b><i class="msg-count msg-count-zero" id="{count}">0</i></a>';return i=t._render(i,{text:"\u96c6\u5206\u5b9d",link:o.score.refLink,count:o.score.countContainer}),e.html(t.scoreInfo,i),this},_createMsgUI:function(){var t=this,i=t._config,n='<a href="{link}" target="_self"><b>{text}</b><i class="msg-count msg-count-zero" id="{count}">0</i></a><div class="etao-nav-list"><ul id="{list}" class="msg-list"></ul><i class="msg-close">&times;</i></div>';return n=t._render(n,{text:"\u6d88\u606f",link:i.msg.refLink,count:i.msg.countContainer,list:i.msg.listContainer}),e.html(t.msgInfo,n),o.on(t.msgInfo,"click",function(o){e.hasClass(o.target,"msg-close")&&(o.preventDefault(),t._closeMsgList())}),this},_getCountForce:function(){var e,o=t.Cookie.get("m_cnt_f");return o&&(e=o.split(",")),e},_notify:function(e){var o=this,i=o._config;e&&("2"==e.t2&&t.Cookie.set(i.msg.closedCookie,"false",-1,i.domain,"/"),o.fetchNewMsg({mpp_sub_type:e.t2}))},fetchNewMsg:function(e){var o=this,i=o._config;t.io({dataType:"jsonp",cache:!1,url:i.fetchAPI,data:e,jsonp:"jsoncallback",success:function(t){o.processMsg(t)}})},processMsg:function(o){if(o.success){var i=this,n=i._config;o.jfb&&0!=o.jfb&&i._updateCount(i.scoreCount,o.jfb),o.total&&0!=o.total&&(e.html(i.msgCount,o.total),o.messages&&0==o.messages.length&&e.hasClass(i.msgCount,n.zeroCls)&&t.Stat&&t.Stat(n.msg.stat.nothrough),e.removeClass(i.msgCount,n.zeroCls)),i._isPopupClosed()||o.messages&&o.messages.length&&i._renderMsgList(o.messages)._openMsgList()}},_updateCount:function(t,o){var i=this,n=i._config;null==o&&(o=0),t&&(0!=o&&e.removeClass(t,n.zeroCls),o>99999&&(o="99999+"),e.html(t,o))},_updateLevel:function(t,o){var i=this,n=i._config;o=o||1,t&&e.addClass(t,n.level.usrLevelCls+o)},_isPopupClosed:function(){var e=this,o=e._config,i=t.Cookie.get(o.msg.closedCookie)||"false";return"true"===i},_renderMsgList:function(t){for(var o=this,i="",n='<li><a href="{link}" title="{count}{desc}" target="_self"><span>{count}</span><b>{desc}</b></a></li>',a=0,s=t.length;s>a;++a)i+=o._render(n,t[a]);return e.html(o.msgList,i),this},_openMsgList:function(){var o=this,i=o._config;return e.hasClass(o.msgInfo,i.msg.activeCls)||t.Stat&&t.Stat(i.msg.stat.through),e.addClass(o.msgInfo,i.msg.activeCls),this},_closeMsgList:function(){var o=this,i=o._config;return e.removeClass(o.msgInfo,i.msg.activeCls),t.Cookie.set(i.msg.closedCookie,"true",1,i.domain,"/"),this}},r={init:function(t){var o=this;o.cfg=t||{redirectUrl:location.href},o.el=e.get("#J_LoginInfo"),o.el&&(o.env=a.getEnv(),o.nick="",o.isLogin=!1,o.writeLoginInfo(),setTimeout(function(){o.initLogout("#J_Logout"),a.initAria("#J_MyLogin"),a.initAria("#J_MyWanke"),a.IE6Hover("#J_MyLogin"),a.IE6Hover("#J_MyWanke")},10),o.accessAllyPass())},accessAllyPass:function(){t.ready(function(t){t.Cookie.get("t")&&t.later(function(){t.Stat.send("//ally.etao.com/pass.htm")},50)})},initLogout:function(e){e=t.get(e),e&&o.on(e,"click",function(t){t.preventDefault(),(new Image).src="//taobao.alipay.com/user/logout.htm",setTimeout(function(){location.href=e.href},20)})},writeLoginInfo:function(){var t,e,o,i,n,s,r=this,l="daily"==r.env||"online"==r.env;l?(t=a.getCookie("tracknick"),e="true"==a.getCookie("login"),n=a.getCookie("a_nk"),i=a.getCookie("l_t"),e&&n&&"alipay"==i?r.nick=n:(r.nick=a.getCookie("_nk_")||t,s=a.getCookie("ck1")||a.getCookie("lgc")),r.isLogin=e&&r.nick||s&&t,r.isLogin||a.getCookie("t")?r._write():r.scriptCookie()):(t=a.getCookie("tracknick"),r.nick=a.getCookie("_nk_")||t,o=a.getCookie("_l_g_"),s=a.getCookie("ck1")||a.getCookie("lgc"),r.isLogin=o&&r.nick||s&&t,r._write())},scriptCookie:function(){var e,o,i,n=this,a="daily"==n.env?"http://etao.daily.taobao.net":"http://etao.taobao.com",s=(new Date).getTime();t.getScript(a+"/cookieinfo.html?t="+s,{success:function(){var t=window.tbcookie;return null==t?void n._write():(e=t.tracknick,n.nick=t._nk_||e,i=t.ck1||t.lgc,o=t._l_g_,n.isLogin=o&&n.nick||i&&e,void n._write())},error:function(){n._write()}})},_write:function(){var o=this,i=o.env,n="daily"==i?"http://login.daily.etao.net":"http://login.etao.com/",r="daily"==i?"http://login.daily.etao.net/logout.html":"http://login.etao.com/logout.html",l=o.cfg.redirectUrl;n+="?redirect_url="+encodeURIComponent(l),r+="?redirect_url="+encodeURIComponent(l);var c,g=o.nick,u=o.isLogin,m="";t.one("body").hasClass("wanke")||(Boolean(u)?(c='<div class="etao-nav-item my-login" id="J_MyLogin">   <a aria-label="\u6211\u7684\u4e00\u6dd8\u83dc\u5355\uff0c\u4e0b\u952e\u6253\u5f00\u83dc\u5355\uff0cESC\u5173\u95ed" aria-haspopup="true" rel="nofollow" href="http://i.etao.com" target="_blank">{user}<i class="xsj">&#8193</i></a>   <ul role="menu" class="etao-nav-list">       <li role="menuitem"><a href="http://i.etao.com/trade/orderlist.html" target="_blank">\u6211\u7684\u8ba2\u5355</a></li>       <li role="menuitem"><a href="http://i.etao.com/favorite/collect_list.html" target="_blank">\u6211\u7684\u6536\u85cf</a></li>       <li role="menuitem"><a href="http://i.etao.com/uservoice/index.html" target="_blank">\u6211\u7684\u53cd\u9988</a></li>       <li role="menuitem"><a id="J_Logout" rel="nofollow" data-stat="{stat}" href="{logout}" target="_top">\u9000\u51fa</a></li>   </ul></div>',m=a.render(c,{user:a.escapeHTML(unescape(g.replace(/\\u/g,"%u"))),stat:"etao.etao_sy.dd.exit",logout:r})):(c='<a rel="nofollow" href="{register}" data-stat="{registerStat}" class="etao-nav-item" target="_top">\u6ce8\u518c</a><div class="etao-nav-item my-login" id="J_MyLogin">    <a aria-label="\u767b\u5f55\u83dc\u5355\uff0c\u4e0b\u952e\u6253\u5f00\u83dc\u5355\uff0cESC\u5173\u95ed" aria-haspopup="true" rel="nofollow" href="{globalLogin}" target="_self"><b>\u767b\u5f55</b><i class="xsj">&#8193</i></a>    <ul role="menu" class="etao-nav-list">        <li role="menuitem"><a rel="nofollow" href="{tbLogin}" data-stat="{tbLoginStat}" target="_top">\u6dd8\u5b9d\u767b\u5f55</a></li>        <li role="menuitem"><a rel="nofollow" href="{aliLogin}" data-stat="{aliLoginStat}" target="_top">\u652f\u4ed8\u5b9d\u767b\u5f55</a></li>    </ul></div>',m=a.render(c,{globalLogin:n,register:"http://www.etao.com/register.html",registerStat:"etao.etao_sy.dd.registration",tbLogin:n+"&logintype=taobao",tbLoginStat:"etao.etao_sy.dd.taobao_login",aliLogin:n+"&logintype=alipay",aliLoginStat:"etao.etao_sy.dd.alipay_login"})),e.html(o.el,m),s.register(Boolean(u)),Boolean(u)&&s.init(o.el))}};return t.augment(i,{initialize:function(){r.init()}}),i},{requires:["dom","event","cookie","ua","io"]});