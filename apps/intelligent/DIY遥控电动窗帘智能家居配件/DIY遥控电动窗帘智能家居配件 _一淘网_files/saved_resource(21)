KISSY.add("components/product-pic/index",function(S,Node,Base,Event,XTemplate){function ProductPic(a){var b=this;ProductPic.superclass.constructor.call(b,a),b._init()}var ACTIVE="active",MAX_WIDTH=300,MAX_HEIGHT=300;return ie6=KISSY.Features.isIELessThan(7),S.extend(ProductPic,Base,{_init:function(){this._parse(),this._bind(),this._initVal(),this._autoAnim()},_parse:function(){var container=this.get("container"),data=container.attr("data-config"),noGood=!1,srcs,allItem;data=eval("("+data+")"),1===data.stockout&&this._showNoGood(),srcs=data.src,srcs&&(this._renderItem(data),this.set("total",srcs.length),allItem=container.all(".item"),this.set("allItem",allItem))},_bind:function(){var a=this.get("container");a&&(a.on("click",this._beforeIndexChange,this),a.on("mouseenter",this._showTrigger,this),a.on("mouseleave",this._hideTrigger,this)),this.on("afterIndexChange",S.bind(this._afterIndexChange,this)),this.on("beforeActiveChange",S.bind(this._beforeActiveChange,this)),this.on("afterActiveChange",S.bind(this._afterActiveChange,this))},_beforeIndexChange:function(a){var b=S.one(a.target),c=this.get("index"),d=this.get("total");b.hasClass("prev")&&c>1?this.set("index",c-1):b.hasClass("next")&&d>c?this.set("index",c+1):d>c?this.set("index",++c):this.set("index",1),this._animate()},_afterIndexChange:function(){var a,b=this.get("indicator"),c=this.get("index"),d=this.get("total"),e=this.get("prev"),f=this.get("next");b.html(c+"/"+d),a=this.get("allItem").item(c-1),this.set("active",a),1===c?e.addClass("first"):e.removeClass("first"),c===d?f.addClass("last"):f.removeClass("last")},_beforeActiveChange:function(a){var b,c=a.newVal;c.one("img")||(b=this._loadPic(c.attr("data-src")),c.append(b))},_afterActiveChange:function(a){var b=a.newVal,c=this.get("allItem");c.removeClass(ACTIVE),b.addClass(ACTIVE)},_showTrigger:function(){this._clearAutoAnim(),this.get("triggerContainer").removeClass("hidden")},_hideTrigger:function(){this._autoAnim(),this.get("triggerContainer").addClass("hidden")},_animate:function(){var a,b=this.get("index"),c=this.get("content");c.isRunning()&&c.stop(),a=-MAX_WIDTH*(b-1),c.animate({transform:"translateX("+a+"px)"},{duration:.4})},_clearAutoAnim:function(){var a=this.get("autoTimer");clearTimeout(a)},_autoAnim:function(){function a(){b.get("autoTimer");Event.fire(c,"click"),b.set("autoTimer",setTimeout(a,3e3))}var b=this,c=b.get("container"),d=b.get("total");d>1&&b.set("autoTimer",setTimeout(a,3e3))},_initVal:function(){var a=this.get("allItem"),b=this.get("indicator"),c=this.get("container"),d=this.get("content"),e=a&&a.item(0),f=a&&a.length,g=c.one(".prev"),h=c.one(".next");triggerContainer=c.one(".trigger-bar"),1>=f&&b.addClass("hidden"),this.set("prev",g),this.set("next",h),this.set("index",1),this.set("total",f),this.set("active",e),this.set("triggerContainer",triggerContainer),b.html("1/"+f),d.css("width",300*f)},_loadPic:function(a){function b(){var a,b,d;a=c.width,b=c.height,(a>MAX_WIDTH||b>MAX_HEIGHT)&&(a/b>=1?d=MAX_WIDTH/a:1>a/b&&(d=MAX_HEIGHT/b),c.width=d*a,c.height=d*b)}var c=new Image;return c.src=a,ie6&&(c.complete?b():c.onload=function(){b()}),c},_showNoGood:function(){var a=this.get("noGoodTpl"),b=this.get("container");b.append(a)},_renderItem:function(a){var b,c=this.get("content"),d=this.get("itemTpl");b=new XTemplate(d).render(a),c.html(b)}},{ATTRS:{container:{value:null,setter:function(a){return a instanceof S.NodeList?a:S.one(a)}},content:{value:null,setter:function(a){return a instanceof S.NodeList?a:S.one(a)}},triggerContainer:{value:null},index:{value:0},indicator:{value:null,setter:function(a){return a instanceof S.NodeList?a:S.one(a)}},prev:{value:null},next:{value:null},total:{value:1},active:{value:null},allItem:{value:null,setter:function(a){return a instanceof S.NodeList?a:S.all(a)}},autoTimer:{value:null},itemTpl:{value:'{{#each src}}<div class="item" data-src="{{this}}"></div>{{/each}}'},noGoodTpl:{value:'<img class="nogood" src="http://gtms01.alicdn.com/tps/i1/T1t0o8XodiXXceU5Yh-51-51.png" al="\u7f3a\u8d27"/><div class="pic-mask"></div>'}}}),ProductPic},{requires:["node","base","event","xtemplate","./index.css"]});