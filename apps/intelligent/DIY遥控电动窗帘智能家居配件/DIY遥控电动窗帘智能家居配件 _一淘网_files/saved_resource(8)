KISSY.add("components/pricetrend/index",function(a,b,c,d){function e(a){var b=this;e.superclass.constructor.call(b,a),b._init()}{var f=function(a){var b=a.split("-");return new Date(parseInt(b[0],10),parseInt(b[1],10)-1,parseInt(b[2],10)).getTime()},g=function(a){var b=new Date(a),c=b.getFullYear(),d=b.getMonth()+1,e=b.getDate();return c+"-"+(d>9?"":"0")+d+"-"+(e>9?"":"0")+e};b.all}return a.extend(e,c,{_init:function(){this._lineChart=null,this._chartData=data_pricetrend,this._chartData.priceState={t0:"\u8be5\u5546\u54c1\u5904\u4e8e\u4ef7\u683c\u6301\u5e73\u72b6\u6001",t1:"\u8be5\u5546\u54c1\u5904\u4e8e\u5386\u53f2\u6700\u4f4e\u72b6\u6001",t2:"\u8be5\u5546\u54c1\u5904\u4e8e\u4ef7\u683c\u4e0b\u8dcc\u72b6\u6001",t3:"\u8be5\u5546\u54c1\u5904\u4e8e\u4ef7\u683c\u4e0a\u6da8\u72b6\u6001",t4:"\u8be5\u5546\u54c1\u5904\u4e8e\u4ef7\u683c\u6ce2\u52a8\u72b6\u6001"},this._initChart(),this._initPriceSummary(),a.log(this._chartData)},_initPriceSummary:function(){var b=a.one("span.price-state");a.one("span.year-low-price").html("&#65509;"+this._chartData.yearLowPrice),a.one("span.low-price").html("&#65509;"+this._chartData.lowestPrice),b.html(this._chartData.priceState["t"+this._chartData.trend]||""),3==this._chartData.trend&&b.css({color:"#f44"}),(4==this._chartData.trend||0==this._chartData.trend)&&b.css({color:"#999"})},_initChart:function(){this._chartData.peakPoints=this._chartData.points.concat(),this._chartData.points=this._fullData(this._chartData.points),this._chartData.points=this._chartData.points.splice(-60,this._chartData.points.length),this._lineChart=new d(this._initChartConfig()),this._markPeakPoints(),this._drawScale()},_drawScale:function(){var b=this._lineChart,c=this,d=b.getHtmlPaper();a.each(b._pointsY,function(a){d.lineX(a.x,a.y,4).css({"border-top":"2px solid #dedede","margin-left":"-3px"})}),a.each(b._pointsX,function(a,b){b%c._drawGap===0&&d.lineY(a.x,a.y,3).css({"border-left":"2px solid #dedede",height:"5px","line-height":"0","margin-left":"-2px"})})},_markPeakPoints:function(){a.log(this._lineChart._pointsY);for(var b=this._lineChart._points[0],c=this._lineChart.getRaphaelPaper(),d=this._chartData.seriesData,e=this._chartData.lowestPrice,f=d.length-1;f>0;f--)if(d[f]==e){point=b[f],c.circle(point.x,point.y,3).attr({stroke:"#F60",fill:"#fff"});break}},_initChartConfig:function(){var b=this,c=[],d=[],e=0,f=0,g=0,h=this._chartData.points.length;for(a.each(this._chartData.points,function(a){c.push(a[0]),d.push(a[1])}),this._chartData.seriesData=d,this._drawGap=d.length<20?19:29,f=this._chartData.maximumPrice=Math.max.apply(null,d),e=this._chartData.lowestPrice=Math.min.apply(null,d);h>g&&d[g]!=e;g++);return this._chartData.lowestPriceIndex=g,{renderTo:".pricetrend-charts",lineType:"straight",canvasAttr:{x:35,y:20,width:243,height:120},colors:["#f93616"],line:{attr:{"stroke-width":2}},points:{attr:{r:0},hoverAttr:{stroke:"#F60",fill:"#fff",r:3,"stroke-width":1}},yLabels:{css:{"font-family":"Microsoft Yahei","font-size":"12px","margin-Left":"-4px"},template:function(a,b){var c=+b,d=/\d+\.(\d+)/;return 100>c&&d.test(b)?c.toFixed(2):c>=1e5?(c/=1e4,Math.floor(c)+"w"):c>1e4&&1e5>c?(c/=1e4,c+"w"):b}},xLabels:{css:{"font-family":"Microsoft Yahei","font-size":"12px","margin-top":"10px"},template:function(a,c){return a%b._drawGap===0?c.replace(/\-/gi,"."):""}},xGrids:{template:function(a){return a.index%b._drawGap==0&&a.paper.lineY(a.x,a.y,a.height).css(a.css)},css:{"border-color":"#f3f3f3"}},xAxis:{text:c,css:{color:"#dedede"}},yAxis:{max:1.02*f,min:.98*e,css:{color:"#dedede"}},comparable:!0,series:[{data:d}],tip:{css:{"border-color":"#DEDEDE","-webkit-box-shadow":"1px 1px 1px 1px #eee","-moz-box-shadow":"1px 1px 1px 1px #eee","box-shadow":"1px 1px 1px 1px #eee"},offset:{x:10,y:10},template:function(a){var b="";for(var c in a.datas)b+="\u65e5\u671f:"+a.datas[c].x+"<br/>",b+="\u4ef7\u683c:&yen;"+a.datas[c].y;return b}}}},_fullData:function(a){for(var b,c,b=f(a[0][0]),d=[a[0]],e=1;e<=a.length-1;e++)b+=864e5,c=f(a[e][0])!==b?[g(b),a[--e][1]]:a[e],d.push(c);return d}},{ATTRS:{}}),e},{requires:["node","base","gallery/kcharts/1.3/linechart/index","./index.css"]});