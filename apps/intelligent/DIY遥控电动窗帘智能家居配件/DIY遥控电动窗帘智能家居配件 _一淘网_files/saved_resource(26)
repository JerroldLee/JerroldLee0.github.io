KISSY.add("ecc/ok-dialog/1.0.0/static",function(){var a={tmpl:'<div class="ok-dialog-container clearfix{{@if mobile}} ok-dialog-container-mobile{{/if}}"><div class="ok-dialog-discount"><h1 class="ok-dialog-hd">\u4eb2\uff0c\u786e\u8ba4\u4ee5\u4e0b\u4f18\u60e0\u54e6\uff01</h1><div class="ok-dialog-bd"><ul class="discount-item-list">{{#coupon}}<li class="discount-item discount-item-coupon clearfix"><div class="discount-hd"><i class="discount-icon discount-icon-coupon"><b>\u4f18\u60e0\u5238</b></i></div><em class="discount-saving">- <b>{{toFixed saving}}</b></em><div class="discount-cnt"><ul class="coupon-list clearfix"><li class="coupon-item coupon-item-selected">{{{title}}}<s class="coupon-selected-icon"></s></li><li class="coupon-deadline">{{#quan}}{{#userQuan}}\uff08\u6709\u6548\u671f\uff1a{{quanDeadline}} \u4e4b\u524d\u4f7f\u7528\uff09{{/userQuan}}{{/quan}}</li></ul><div class="coupon-action">{{@if cost}}{{cost_desc}}<a class="coupon-btn coupon-exchange" href="javascript:void(0);" title="\u6362\u53d6">\u6362\u53d6</a><a class="coupon-btn coupon-unexchange" href="javascript:void(0);" title="\u53d6\u6d88">\u53d6\u6d88</a>{{/if}}<div class="coupon-copy"></div>{{#quan}}<p class="coupon-status">{{{msg}}}</p>{{/quan}}</div></div><div class="discount-status discount-status-{{#quan}}{{@if success}}done{{else}}undone{{/if}}{{/quan}}{{^if quan}}undone{{/if}}"><i class="iconfont discount-status-ok">&#126</i><i class="iconfont discount-status-err">&#223</i></div></li>{{/coupon}}{{#rebate}}<li class="discount-item clearfix"><div class="discount-hd">{{@if present}}<i class="discount-icon discount-icon-present"><b>\u4e00\u6dd8\u9001</b></i>{{else}}<i class="discount-icon discount-icon-rebate"><b>\u96c6\u5206\u5b9d</b></i>{{/if}}</div><em class="discount-saving">- <b>{{toFixed saving}}</b></em><div class="discount-cnt"><div class="discount-con">{{{desc}}}</div>{{#present}}<span class="rebate-present">{{tip}}</span>{{/present}}{{#level}}<div class="rebate-level"><i class="rebate-icon {{speed}}"></i>{{{caption}}}</div>{{/level}}</div><div class="discount-status discount-status-done"><i class="iconfont discount-status-ok">&#126</i><i class="iconfont discount-status-err">&#223</i></div></li>{{/rebate}}{{#activity}}<li class="discount-item clearfix"><div class="discount-hd"><i class="discount-icon discount-icon-promotion"><b>\u4fc3\u9500</b></i></div><em class="discount-saving">- <b>{{toFixed saving}}</b></em><div class="discount-cnt"><div class="discount-con">{{{desc}}}</div></div><div class="discount-status discount-status-done"><i class="iconfont discount-status-ok">&#126</i><i class="iconfont discount-status-err">&#223</i></div></li>{{/activity}}{{#newcomer}}<li class="discount-item clearfix"><div class="discount-hd"><i class="discount-icon discount-icon-newcomer"><b>\u65b0\u4eba\u9001</b></i></div><em class="discount-saving">- <b>{{toFixed saving}}</b></em><div class="discount-cnt"><div class="discount-con">{{{desc}}}</div></div><div class="discount-status discount-status-done"><i class="iconfont discount-status-ok">&#126</i><i class="iconfont discount-status-err">&#223</i></div></li>{{/newcomer}}{{#code}}<li class="discount-item clearfix"><div class="discount-hd"><i class="discount-icon discount-icon-code"><b>\u4f18\u60e0\u7801</b></i></div><em class="discount-saving">- <b>{{toFixed saving}}</b></em><div class="discount-cnt"><div class="discount-con">{{{desc}}}</div></div><div class="discount-status discount-status-done"><i class="iconfont discount-status-ok">&#126</i><i class="iconfont discount-status-err">&#223</i></div></li>{{/code}}</ul></div><div class="ok-dialog-ft"><div class="purchase-action clearfix"><div class="purchase-info">{{{include "priceTmpl"}}}{{#coupon}}{{@if admix}}<span class="purchase-remind">\u51d1\u6ee1{{full_cut}}\u5143\u540e\u518d\u7701{{admix}}\u5143</span>{{/if}}{{/coupon}}</div><a href="{{link}}" target="_blank" class="J_OkDialogBtn purchase-link" data-stat="{{stat}}"><em class="purchase-button">\u53bb\u5546\u5bb6\u8d2d\u4e70</em></a></div></div></div>{{#mobile}}<div class="ok-dialog-mobile"><div class="mobile-content mobile-{{@if sav}}saving{{else}}rebate{{/if}}"><s class="t"></s><s class="s"></s><em>{{@if sav}}{{toFixed sav}}{{else}}{{reb}}{{/if}}</em><s class="m"></s></div><div class="J_QRCode mobile-qrcode">{{@if qr}}<img width="120" height="120" src="{{qr}}" alt="QR Code" />{{/if}}</div><i class="ok-dialog-split"></i></div>{{/mobile}}</div>',status:{0:{normal:"\u8bf7\u5728\u5546\u5bb6\u9875\u9762\u4e0b\u5355\u65f6\u4f7f\u7528",other:"\u590d\u5236\u5361\u53f7/\u5361\u5bc6\u5728\u5546\u5bb6\u9875\u9762\u4e0b\u5355\u65f6\u4f7f\u7528"},7:'\u4eb2\uff0c\u60a8\u9009\u62e9\u7684\u4f18\u60e0\u5238\u9700\u8981\u652f\u4ed8\u5b9d\u5b9e\u540d\u8ba4\u8bc1\u3002<a href="https://certify.alipay.com/certifyInfo.htm" target="_blank">\u53bb\u8ba4\u8bc1</a>',9:"\u4f18\u60e0\u5238\u5373\u5c06\u5f00\u59cb\u9886\u53d6\uff0c\u8bf7\u7a0d\u540e\u518d\u6765",11:"\u62b1\u6b49\uff0c\u60a8\u7684\u6765\u6e90\u6e20\u9053\u4e0d\u6b63\u786e\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5",12:"\u62b1\u6b49\uff0c\u60a8\u7684\u96c6\u5206\u5b9d\u4f59\u989d\u4e0d\u8db3",14:"\u62b1\u6b49\uff0c\u60a8\u7684\u6dd8\u5b9d\u4f1a\u5458\u7b49\u7ea7\u672a\u6fc0\u6d3b\uff0c\u8bf7\u6fc0\u6d3b\u540e\u518d\u9886\u53d6",15:"\u62b1\u6b49\uff0c\u60a8\u7684\u6dd8\u5b9d\u4f1a\u5458\u7b49\u7ea7\u4e0d\u591f\uff0c\u65e0\u6cd5\u9886\u53d6\u6b64\u5238",16:"\u62b1\u6b49\uff0c\u8be5\u5238\u4e3a\u652f\u4ed8\u5b9d\u91d1\u8d26\u6237\u4f1a\u5458\u4e13\u4eab\u5238",17:"\u62b1\u6b49\uff0c\u60a8\u4e0d\u662f\u4fe1\u7528\u5361\u5feb\u6377\u652f\u4ed8\u8d26\u6237\u4f1a\u5458\uff0c\u76ee\u524d\u65e0\u6cd5\u9886\u53d6\u6b64\u5238",18:"\u62b1\u6b49\uff0c\u60a8\u4e0d\u662f\u501f\u8bb0\u5361\u5feb\u6377\u652f\u4ed8\u8d26\u6237\u4f1a\u5458\uff0c\u76ee\u524d\u65e0\u6cd5\u9886\u53d6\u6b64\u5238",25:"\u4eb2\uff0c\u60a8\u5df2\u9886\u53d6\u5e76\u4f7f\u7528\u4e86\u8be5\u4f18\u60e0\u5238\uff0c\u4e0d\u80fd\u91cd\u590d\u9886\u53d6",26:'\u606d\u559c\uff01\u4f18\u60e0\u5238\u9886\u53d6\u6210\u529f\u3002\u8be5\u4f18\u60e0\u5238\u9700\u6fc0\u6d3b\u540e\u624d\u80fd\u4f7f\u7528\u3002<a href="{href}" target="_blank">\u70b9\u6b64\u5904\u6fc0\u6d3b</a>',"-2,1,2,4,10,13,19,20":"\u62b1\u6b49\uff0c\u8be5\u5238\u5df2\u88ab\u9886\u5b8c","error,-1,5,6,21":"\u62b1\u6b49\uff0c\u6682\u65f6\u65e0\u6cd5\u9886\u53d6\u4f18\u60e0\u5238\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5","3,8":"\u4eb2\uff0c\u60a8\u5df2\u9886\u53d6\u8fc7\u8be5\u4f18\u60e0\u5238\uff0c\u8bf7\u5728\u4e0b\u5355\u65f6\u4f7f\u7528\u6216\u9009\u62e9\u5176\u5b83\u4f18\u60e0\u5238"}};return a}),KISSY.add("ecc/ok-dialog/1.0.0/index",function(a,b,c,d){return a.config({packages:{ok:{path:"",charset:"gbk",debug:!0}},modules:{"ok/zeroclipboard":{path:"http://www.etao.com/go/rgn/etao/ok/zeroclipboard-v2.php"}}}),b.Dialog.extend({initializer:function(){this.render(),this._bindEvents()},popup:function(b){var c=this,d=a.Promise;if(b=a.clone(b),a.isPlainObject(b)&&!a.isEmptyObject(b)){c.set("data",b),c.show();var e=!b.mobile&&b.wapUrl&&(b.qrUrl||b.qrLink),f=b.coupon&&0==b.coupon.cost;return e&&f?void d.all([c._claimWap(),c._claimQr(),c._claimCoupon()]).then(function(a){c._process.call(c,{wap:a[0],qr:a[1],coupon:a[2]})}):e?void d.all([c._claimWap(),c._claimQr()]).then(function(a){c._process.call(c,{wap:a[0],qr:a[1]})}):f?void d.when(c._claimCoupon(),function(a){c._process.call(c,{coupon:a})}):void c._display()}},_display:function(){var a,b=this,c=b.get("data"),d=b.get("tmpler"),e=b.get("contentEl"),f=b.get("qrSize"),g=c.qrLink,h=b.QRCode;c.stat=b.get("stat").order,b.get("closeBtn").attr({"data-stat":b.get("stat").close}),c.mobile&&b.set("width",b.get("widthSet").mobile),e.html(d.render(c)),c.mobile&&g&&(a=e.all(".J_QRCode"),new h(a[0],{text:g,width:f,height:f,correctLevel:h.CorrectLevel.L}),a.attr("title","")),b.set("height","auto"),b.unloading(),b.center(),c.quan&&b._couponHandler()},_process:function(b){var c,d=this,e=d.get("data"),f=b.wap,g=b.qr,h=b.coupon,i={};if(f&&f.success&&(c=f.result).type){switch(c.type){case 1:i.sav=c.moreSaving;break;case 2:i.reb=c.moreRebate}g&&g.success&&(c=g.result)&&(i.qr=c.replace(".jpg","_120x120.jpg")),a.isEmptyObject(i)||(e.mobile=i)}h&&d._renderCoupon(h),d._display()},_bindEvents:function(){var b=this,c=b.get("el"),d=b.get("trigger"),e=a.one;e(window).on("resize scroll",a.buffer(function(){b.center()},100)),e(document).delegate("click",d,function(c){var d,f=e(c.currentTarget);try{d=new Function("return "+f.attr("data-config"))()}catch(g){a.log("data-config parse error","error")}a.isEmptyObject(d)||b.popup(d)}),c.delegate("click",".coupon-exchange",function(){var a=c.one(".coupon-action");a.html('<p class="coupon-loading">\u5904\u7406\u4e2d...</p>'),b._claimCoupon().then(function(a){b._renderCoupon(a),b._couponHandler(!0)})}),c.delegate("click",".coupon-unexchange",function(){var a=c.one(".coupon-action");a.fadeOut(.3,function(){b._renderCoupon({success:!1}),b._couponHandler()})}),c.delegate("click",".J_OkDialogBtn",function(){var a=b.get("autoHide"),c=b.get("data"),d=c.quan||{},e=d.userQuan||{};!a||e.quanNumber||e.quanPassword||b.close()})},_claimWap:function(){var b=this,c=b.get("data"),d=c.coupon||{},e=c.rebate||{},f=c.newcomer||{},g=a.Defer();return a.io({url:c.wapUrl,dataType:"jsonp",data:{pcFinal:c["final"],pcRebate:Math.round(100*(e.saving||0)+100*(f.saving||0)),skuId:c.skuId,pcQuan:d.saving,quanId:d.id,quanSource:d.source},timeout:3,complete:function(a){g.resolve(a)}}),g.promise},_claimQr:function(){var b=this,c=b.get("data"),d=a.Defer();return c.qrUrl?a.io({url:c.qrUrl,dataType:"jsonp",timeout:3,complete:function(a){d.resolve(a)}}):c.qrLink&&a.use("gallery/qrcode/1.0/",function(a,c){b.QRCode=c,d.resolve()}),d.promise},_claimCoupon:function(){var b=this,c=b.get("data").coupon,d=a.Defer();return a.io({url:c.api,dataType:"jsonp",timeout:3,complete:function(a){d.resolve(a)}}),d.promise},_couponHandler:function(a){var b=this,c=b.get("el"),d=b.get("data"),e=d.coupon,f=e.saving,g=0!=e.admix,h=d.quan,i=h.userQuan,j=c.one(".discount-item-coupon"),k=c.one(".coupon-action"),l=c.all(".purchase-remind"),m=c.all(".purchase-price").one("b"),n=c.all(".purchase-saving").one("b");k.html('<div class="coupon-copy"></div><p class="coupon-status">'+h.msg+"</p>"),h.success&&a&&(j.one(".discount-status").replaceClass("discount-status-undone","discount-status-done"),j.all(".discount-saving").one("b").html(g?"0.00":f.toFixed(2)),j.one(".coupon-deadline").html("\uff08\u6709\u6548\u671f\uff1a"+i.quanDeadline+" \u4e4b\u524d\u4f7f\u7528\uff09")),h.success||(j.addClass("discount-item-coupon-disabled"),j.one(".coupon-item").removeClass("coupon-item-selected"),!g&&f>0&&(m&&m.html((d["final"]+f).toFixed(2)),n&&n.html((d.total-f).toFixed(2))),l.hide()),i&&(i.quanNumber||i.quanPassword)&&b._copyGear(c.one(".coupon-copy"),i)},_renderCoupon:function(b){function c(b,c){var d,e="normal";return b=String(b),c=c||{},d=g[String(b)]||g.error,"0"==b&&((c.quanPassword||c.quanNumber)&&(e="other"),d=g[b][e]),a.substitute(d,c)}var d,e,f=this,g=f.get("status");d=b.success&&(e=b.data)?{success:e.success,msg:c(e.errorCode,e.userQuan),userQuan:e.userQuan}:{success:!1,msg:c(b.errorCode||"error")},a.mix(f.get("data"),{quan:d})},_copyGear:function(b,d){var e=function(){var a='{{@if quanNumber}}<div class="copy-item">\u5361\u53f7\uff1a<b id="card-txt" class="J_copyText">{{quanNumber}}</b><a href="javascript:void(0);" data-clipboard-target="card-txt" class="copy-btn J_copyButton">\u590d\u5236</a></div>{{/if}}{{@if quanPassword}}<div class="copy-item">\u5361\u5bc6\uff1a<b id="card-pwd" class="J_copyText">{{quanPassword}}</b><a href="javascript:void(0);" data-clipboard-target="card-pwd" class="copy-btn J_copyButton">\u590d\u5236</a></div>{{/if}}';return new c(a)}();b.html(e.render(d)).show();var f=b.all(".J_copyButton");a.use("ok/zeroclipboard",function(a,b){var c=new b(f);c.on("noflash",function(a){a.unglue(f),f.remove()}),c.on("complete",function(){var b,c=a.one(this);c.text("\u590d\u5236\u6210\u529f"),a.later(function(){c.text("\u590d\u5236"),clearTimeout(b)},1e3)})})}},{ATTRS:{autoHide:{value:!1},stat:{value:{order:"",close:""}},widthSet:{value:{normal:570,mobile:750}},heightSet:{value:350},qrSize:{value:120},prefixCls:{value:"ok-"},elStyle:{value:{position:6==a.UA.ie?"absolute":"fixed"}},mask:{value:!0},trigger:{value:""},status:{valueFn:function(){var b=d.status,c={};return a.each(b,function(b,d){a.each(d.split(","),function(a){c[a]=b})}),c}},data:{value:{}},tmpler:{valueFn:function(){return new c(d.tmpl,{subTpls:{priceTmpl:this.get("priceTmpl")},commands:{toFixed:function(a,b){return parseFloat(b.params[0]).toFixed(2)}}})}},priceTmpl:{value:'<span class="purchase-price">\u5230\u624b\u4ef7<i class="yen">&yen;</i><b>{{final}}</b></span>'},listeners:{value:{afterRenderUI:function(){this.get("maskNode").addClass(this.get("prefixCls")+"dialog-mask-hidden"),a.add("priceTmpl",this.get("priceTmpl"))},show:function(){this.loading(),this.set("width",this.get("widthSet").normal),this.set("height",this.get("heightSet")),this.center()},hide:function(){this.reset("data"),this.get("contentEl").html("")}}}}},{name:"ok-dialog"})},{requires:["overlay","xtemplate","./static","ajax","./index.css"]});