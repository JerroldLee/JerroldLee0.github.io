KISSY.add("components/scan-code/index",function(a,b,c){function d(a){var b=this;d.superclass.constructor.call(b,a),b._init()}var e=b.all;return a.extend(d,c,{_init:function(){var a=this;a._renderCodeImg(),a._renderFavorInfo(0),window.globalEvent.on("quanChange",function(b){a._renderFavorInfo(b.index)})},_renderFavorInfo:function(b){if(window.codePlan){var c=this,d=e(c.get("target")),f=window.codePlan[parseInt(b)],g=d.attr("data-url");if(!f||!g)return;var h={};h.pcFinal=f["final"],h.pcRebate=f.rebate&&f.rebate.saving?100*f.rebate.saving:0,f.coupon&&(h.quanId=f.coupon.id,h.quanSource=f.coupon.source),a.io({url:g,data:h,type:"GET",dataType:"jsonp",success:function(b){if(b.success&&b.result){if(window.mobileInfo={favorType:b.result.type,moreRebate:b.result.moreRebate,moreSaving:b.result.moreSaving},2==b.result.type)return void d.one(".mr").html("");if(1==b.result.type)return d.one(".mr").html('\u624b\u673a\u8d2d\u4e70\u518d\u591a\u7701<span class="orange">'+b.result.moreSaving.toFixed(2)+"</span>\u94b1"),void(a.one("#mobile-tip")&&(a.one("#mobile-tip").removeClass("hidden"),a.one("#mobile-tip .mobile-tip-des").html("\u518d\u7701"+b.result.moreSaving.toFixed(2)+"\u94b1")))}}})}},_renderCodeImg:function(){var b=this,c=e(b.get("target"));c.attr("img-url")&&a.use("gallery/qrcode/1.0/",function(a,b){new b("code-img",{text:c.attr("img-url"),width:80,height:80,correctLevel:b.CorrectLevel.L}),c.one("#code-img").css("background","transparent")})}},{ATTRS:{target:{value:"#scancode"}}}),d},{requires:["node","base","event","io","overlay","./index.css"]});